!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.goldenLayout=e():t.goldenLayout=e()}(globalThis,(()=>(()=>{"use strict";var t,e={d:(t,i)=>{for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},i={};e.r(i),e.d(i,{ApiError:()=>r,BindError:()=>a,BrowserPopout:()=>ot,ComponentContainer:()=>nt,ComponentItem:()=>ut,ComponentItemConfig:()=>W,ConfigurationError:()=>o,ContentItem:()=>st,DragSource:()=>vt,EventEmitter:()=>it,EventHub:()=>yt,ExternalError:()=>n,GoldenLayout:()=>bt,Header:()=>ht,HeaderedItemConfig:()=>k,I18nStrings:()=>t,ItemConfig:()=>A,ItemType:()=>y,JsonValue:()=>C,LayoutConfig:()=>O,LayoutManager:()=>It,LogicalZIndex:()=>_,LogicalZIndexToDefaultMap:()=>v,PopoutBlockedError:()=>s,PopoutLayoutConfig:()=>B,ResolvedComponentItemConfig:()=>D,ResolvedGroundItemConfig:()=>M,ResolvedHeaderedItemConfig:()=>E,ResolvedItemConfig:()=>S,ResolvedLayoutConfig:()=>T,ResolvedPopoutLayoutConfig:()=>P,ResolvedRootItemConfig:()=>z,ResolvedRowOrColumnItemConfig:()=>L,ResolvedStackItemConfig:()=>x,ResponsiveMode:()=>I,RootItemConfig:()=>U,RowOrColumn:()=>gt,RowOrColumnItemConfig:()=>H,Side:()=>f,SizeUnitEnum:()=>w,Stack:()=>mt,StackItemConfig:()=>R,StyleConstants:()=>p,Tab:()=>lt,VirtualLayout:()=>wt,WidthOrHeightPropertyName:()=>g,formatSize:()=>tt,formatUndefinableSize:()=>et,i18nStrings:()=>u,parseSize:()=>Q});class n extends Error{constructor(t,e){super(e),this.type=t}}class o extends n{constructor(t,e){super("Configuration",t),this.node=e}}class s extends n{constructor(t){super("PopoutBlocked",t)}}class r extends n{constructor(t){super("API",t)}}class a extends n{constructor(t){super("Bind",t)}}class l extends Error{constructor(t,e,i){super(`${t}: ${e}${void 0===i?"":": "+i}`)}}class d extends l{constructor(t,e){super("Assert",t,e)}}class h extends l{constructor(t,e,i){super("UnreachableCase",t,`${e}${void 0===i?"":": "+i}`)}}class c extends l{constructor(t,e){super("UnexpectedNull",t,e)}}class m extends l{constructor(t,e){super("UnexpectedUndefined",t,e)}}!function(t){let e=!1;const i={PopoutCannotBeCreatedWithGroundItemConfig:{id:0,default:"Popout cannot be created with ground ItemConfig"},PleaseRegisterAConstructorFunction:{id:1,default:"Please register a constructor function"},ComponentTypeNotRegisteredAndBindComponentEventHandlerNotAssigned:{id:2,default:"Component type not registered and BindComponentEvent handler not assigned"},ComponentIsAlreadyRegistered:{id:3,default:"Component is already registered"},ComponentIsNotVirtuable:{id:4,default:"Component is not virtuable. Requires rootHtmlElement field/getter"},VirtualComponentDoesNotHaveRootHtmlElement:{id:5,default:'Virtual component does not have getter "rootHtmlElement"'},ItemConfigIsNotTypeComponent:{id:6,default:"ItemConfig is not of type component"},InvalidNumberPartInSizeString:{id:7,default:"Invalid number part in size string"},UnknownUnitInSizeString:{id:8,default:"Unknown unit in size string"},UnsupportedUnitInSizeString:{id:9,default:"Unsupported unit in size string"}};t.idCount=Object.keys(i).length;const n=Object.values(i);t.checkInitialise=function(){if(!e)for(let e=0;e<t.idCount;e++){const t=n[e];if(t.id!==e)throw new d("INSI00110",`${e}: ${t.id}`);u[e]=t.default}e=!0}}(t||(t={}));const u=new Array(t.idCount);var p,g,f,_;!function(t){t.defaultComponentBaseZIndex="auto",t.defaultComponentDragZIndex="32",t.defaultComponentStackMaximisedZIndex="41"}(p||(p={})),function(t){t.width="width",t.height="height"}(g||(g={})),function(t){t.top="top",t.left="left",t.right="right",t.bottom="bottom"}(f||(f={})),function(t){t.base="base",t.drag="drag",t.stackMaximised="stackMaximised"}(_||(_={}));const v={base:p.defaultComponentBaseZIndex,drag:p.defaultComponentDragZIndex,stackMaximised:p.defaultComponentStackMaximisedZIndex};var C,y,I,w,b,S,E,x,D,L,z,M,T,P,A,k,R,W,H,U,O,B,F;function N(t){return t.toString(10)+"px"}function V(t){const e=t.replace("px","");return parseFloat(e)}function G(t){return t>="0"&&t<="9"}function Z(t,e){const i=N(e);t.style.width=i}function q(t,e){const i=N(e);t.style.height=i}function j(t){return{width:t.offsetWidth,height:t.offsetHeight}}function $(t,e){t.style.display=e?"":"none"}function X(t){document.querySelectorAll("iframe.lm_content").forEach((e=>e.style.setProperty("pointer-events",t?"":"none")))}function Y(t,e){if(void 0!==e)for(const i in e)if(e.hasOwnProperty(i)){const n=e[i],o=t[i];t[i]=J(o,n)}return t}function J(t,e){if("object"!=typeof e)return e;if(Array.isArray(e)){const t=e.length,i=new Array(t);for(let n=0;n<t;n++){const t=e[n];i[n]=J({},t)}return i}if(null===e)return null;{const i=e;return void 0===t||("object"!=typeof t||Array.isArray(t))?Y({},i):Y(null===t?{}:t,i)}}function K(){return(1e15*Math.random()).toString(36).replace(".","")}function Q(t,e){const{numericPart:i,firstNonNumericCharPart:n}=function(t){const e=(t=t.trimStart()).length;if(0===e)return{numericPart:"",firstNonNumericCharPart:""};{let i=e,n=!1;for(let o=0;o<e;o++){const e=t[o];if(!G(e)){if("."!==e){i=o;break}if(n){i=o;break}n=!0}}return{numericPart:t.substring(0,i),firstNonNumericCharPart:t.substring(i).trim()}}}(t),s=Number.parseInt(i,10);if(isNaN(s))throw new o(`${u[7]}: ${t}`);{const i=w.tryParse(n);if(void 0===i)throw new o(`${u[8]}: ${t}`);if(e.includes(i))return{size:s,sizeUnit:i};throw new o(`${u[9]}: ${t}`)}}function tt(t,e){return t.toString(10)+w.format(e)}function et(t,e){return void 0===t?void 0:t.toString(10)+w.format(e)}!function(t){function e(t){return!Array.isArray(t)&&null!==t&&"object"==typeof t}t.isJson=function(t){return e(t)},t.isJsonObject=e}(C||(C={})),function(t){t.ground="ground",t.row="row",t.column="column",t.stack="stack",t.component="component"}(y||(y={})),function(t){t.none="none",t.always="always",t.onload="onload"}(I||(I={})),function(t){t.Pixel="px",t.Percent="%",t.Fractional="fr",t.Em="em"}(w||(w={})),function(t){t.tryParse=function(e){switch(e){case t.Pixel:return t.Pixel;case t.Percent:return t.Percent;case t.Fractional:return t.Fractional;case t.Em:return t.Em;default:return}},t.format=function(e){switch(e){case t.Pixel:return t.Pixel;case t.Percent:return t.Percent;case t.Fractional:return t.Fractional;case t.Em:return t.Em;default:throw new h("SUEF44998",e)}}}(w||(w={})),function(t){const e=["settings","hasHeaders","constrainDragToContainer","selectionEnabled","dimensions","borderWidth","minItemHeight","minItemWidth","headerHeight","dragProxyWidth","dragProxyHeight","labels","close","maximise","minimise","popout","content","componentType","componentState","id","width","type","height","isClosable","title","popoutWholeStack","openPopouts","parentId","activeItemIndex","reorderEnabled","borderGrabWidth"],i=[!0,!1,"row","column","stack","component","close","maximise","minimise","open in new window"];function n(t,e){const i={};for(const n in t)if(t.hasOwnProperty(n)){let a;a=e?s(n):r(n);const l=t[n];i[a]=o(l,e)}return i}function o(t,e){return"object"==typeof t?null===t?null:Array.isArray(t)?function(t,e){const i=t.length,n=new Array(i);for(let s=0;s<i;s++){const i=t[s];n[s]=o(i,e)}return n}(t,e):n(t,e):e?function(t){if("string"==typeof t&&1===t.length)return"___"+t;const e=function(t){for(let e=0;e<i.length;e++)if(i[e]===t)return e;return-1}(t);return-1===e?t:e.toString(36)}(t):"string"==typeof(s=t)&&1===s.length?i[parseInt(s,36)]:"string"==typeof s&&"___"===s.substr(0,3)?s[3]:s;var s}function s(t){if("string"==typeof t&&1===t.length)return"___"+t;const i=function(t){for(let i=0;i<e.length;i++)if(e[i]===t)return i;return-1}(t);return-1===i?t:i.toString(36)}function r(t){return 1===t.length?e[parseInt(t,36)]:"___"===t.substr(0,3)?t[3]:t}t.checkInitialise=function(){if(e.length>36)throw new Error("Too many keys in config minifier map")},t.translateObject=n}(b||(b={})),function(t){t.defaults={type:y.ground,content:[],size:1,sizeUnit:w.Fractional,minSize:void 0,minSizeUnit:w.Pixel,id:"",isClosable:!0},t.createCopy=function(t,e){switch(t.type){case y.ground:case y.row:case y.column:return L.createCopy(t,e);case y.stack:return x.createCopy(t,e);case y.component:return D.createCopy(t);default:throw new h("CICC91354",t.type,"Invalid Config Item type specified")}},t.createDefault=function(t){switch(t){case y.ground:throw new d("CICCDR91562");case y.row:case y.column:return L.createDefault(t);case y.stack:return x.createDefault();case y.component:return D.createDefault();default:throw new h("CICCDD91563",t,"Invalid Config Item type specified")}},t.isComponentItem=function(t){return t.type===y.component},t.isStackItem=function(t){return t.type===y.stack},t.isGroundItem=function(t){return t.type===y.ground}}(S||(S={})),function(t){let e;t.defaultMaximised=!1,function(t){t.createCopy=function(t,e){return void 0===t?void 0:{show:null!=e?e:t.show,popout:t.popout,close:t.close,maximise:t.maximise,minimise:t.minimise,tabDropdown:t.tabDropdown}}}(e=t.Header||(t.Header={}))}(E||(E={})),function(t){function e(t){const e=t.length,i=new Array(e);for(let n=0;n<e;n++)i[n]=S.createCopy(t[n]);return i}t.defaultActiveItemIndex=0,t.createCopy=function(t,i){return{type:t.type,content:e(void 0!==i?i:t.content),size:t.size,sizeUnit:t.sizeUnit,minSize:t.minSize,minSizeUnit:t.minSizeUnit,id:t.id,maximised:t.maximised,isClosable:t.isClosable,activeItemIndex:t.activeItemIndex,header:E.Header.createCopy(t.header)}},t.copyContent=e,t.createDefault=function(){return{type:y.stack,content:[],size:S.defaults.size,sizeUnit:S.defaults.sizeUnit,minSize:S.defaults.minSize,minSizeUnit:S.defaults.minSizeUnit,id:S.defaults.id,maximised:E.defaultMaximised,isClosable:S.defaults.isClosable,activeItemIndex:t.defaultActiveItemIndex,header:void 0}}}(x||(x={})),function(t){t.defaultReorderEnabled=!0,t.resolveComponentTypeName=function(t){const e=t.componentType;return"string"==typeof e?e:void 0},t.createCopy=function(t){return{type:t.type,content:[],size:t.size,sizeUnit:t.sizeUnit,minSize:t.minSize,minSizeUnit:t.minSizeUnit,id:t.id,maximised:t.maximised,isClosable:t.isClosable,reorderEnabled:t.reorderEnabled,title:t.title,header:E.Header.createCopy(t.header),componentType:t.componentType,componentState:J(void 0,t.componentState)}},t.createDefault=function(e="",i,n=""){return{type:y.component,content:[],size:S.defaults.size,sizeUnit:S.defaults.sizeUnit,minSize:S.defaults.minSize,minSizeUnit:S.defaults.minSizeUnit,id:S.defaults.id,maximised:E.defaultMaximised,isClosable:S.defaults.isClosable,reorderEnabled:t.defaultReorderEnabled,title:n,header:void 0,componentType:e,componentState:i}},t.copyComponentType=function(t){return J({},t)}}(D||(D={})),function(t){function e(t){const e=t.length,i=new Array(e);for(let n=0;n<e;n++)i[n]=S.createCopy(t[n]);return i}t.isChildItemConfig=function(t){switch(t.type){case y.row:case y.column:case y.stack:case y.component:return!0;case y.ground:return!1;default:throw new h("CROCOSPCICIC13687",t.type)}},t.createCopy=function(t,i){return{type:t.type,content:e(void 0!==i?i:t.content),size:t.size,sizeUnit:t.sizeUnit,minSize:t.minSize,minSizeUnit:t.minSizeUnit,id:t.id,isClosable:t.isClosable}},t.copyContent=e,t.createDefault=function(t){return{type:t,content:[],size:S.defaults.size,sizeUnit:S.defaults.sizeUnit,minSize:S.defaults.minSize,minSizeUnit:S.defaults.minSizeUnit,id:S.defaults.id,isClosable:S.defaults.isClosable}}}(L||(L={})),function(t){t.createCopy=function(t){return S.createCopy(t)},t.isRootItemConfig=function(t){switch(t.type){case y.row:case y.column:case y.stack:case y.component:return!0;case y.ground:return!1;default:throw new h("CROCOSPCICIC13687",t.type)}}}(z||(z={})),function(t){t.create=function(t){const e=void 0===t?[]:[t];return{type:y.ground,content:e,size:100,sizeUnit:w.Percent,minSize:0,minSizeUnit:w.Pixel,id:"",isClosable:!1,title:"",reorderEnabled:!1}}}(M||(M={})),function(t){let e,i,n;function o(t){return"parentId"in t}!function(t){t.defaults={useDragAndDrop:!0,copyForDragImage:void 0,showOldPositionWhenDragging:!0,dragDataMimetype:"text/gl-drag-data",checkGlWindowKey:!0,constrainDragToContainer:!0,reorderEnabled:!0,popoutWholeStack:!1,blockedPopoutsThrowError:!0,closePopoutsOnUnload:!0,responsiveMode:I.none,tabOverlapAllowance:0,reorderOnTabMenuClick:!0,tabControlOffset:10,popInOnClose:!1},t.createCopy=function(t){return{useDragAndDrop:t.useDragAndDrop,copyForDragImage:t.copyForDragImage,showOldPositionWhenDragging:t.showOldPositionWhenDragging,dragDataMimetype:t.dragDataMimetype,checkGlWindowKey:t.checkGlWindowKey,constrainDragToContainer:t.constrainDragToContainer,reorderEnabled:t.reorderEnabled,popoutWholeStack:t.popoutWholeStack,blockedPopoutsThrowError:t.blockedPopoutsThrowError,closePopoutsOnUnload:t.closePopoutsOnUnload,responsiveMode:t.responsiveMode,tabOverlapAllowance:t.tabOverlapAllowance,reorderOnTabMenuClick:t.reorderOnTabMenuClick,tabControlOffset:t.tabControlOffset,popInOnClose:t.popInOnClose}}}(e=t.Settings||(t.Settings={})),function(t){t.createCopy=function(t){return{borderWidth:t.borderWidth,borderGrabWidth:t.borderGrabWidth,contentInset:t.contentInset,defaultMinItemHeight:t.defaultMinItemHeight,defaultMinItemHeightUnit:t.defaultMinItemHeightUnit,defaultMinItemWidth:t.defaultMinItemWidth,defaultMinItemWidthUnit:t.defaultMinItemWidthUnit,headerHeight:t.headerHeight,dragProxyWidth:t.dragProxyWidth,dragProxyHeight:t.dragProxyHeight}},t.defaults={borderWidth:5,borderGrabWidth:5,contentInset:0,defaultMinItemHeight:0,defaultMinItemHeightUnit:w.Pixel,defaultMinItemWidth:10,defaultMinItemWidthUnit:w.Pixel,headerHeight:20,dragProxyWidth:300,dragProxyHeight:200}}(i=t.Dimensions||(t.Dimensions={})),function(t){t.createCopy=function(t){return{show:t.show,popout:t.popout,dock:t.dock,close:t.close,maximise:t.maximise,minimise:t.minimise,tabDropdown:t.tabDropdown}},t.defaults={show:f.top,popout:"open in new window",dock:"dock",maximise:"maximise",minimise:"minimise",close:"close",tabDropdown:"additional tabs"}}(n=t.Header||(t.Header={})),t.isPopout=o,t.createDefault=function(){return{root:void 0,openPopouts:[],dimensions:t.Dimensions.defaults,settings:t.Settings.defaults,header:t.Header.defaults,resolved:!0}},t.createCopy=function(e){return o(e)?P.createCopy(e):{root:void 0===e.root?void 0:z.createCopy(e.root),openPopouts:t.copyOpenPopouts(e.openPopouts),settings:t.Settings.createCopy(e.settings),dimensions:t.Dimensions.createCopy(e.dimensions),header:t.Header.createCopy(e.header),resolved:e.resolved}},t.copyOpenPopouts=function(t){const e=t.length,i=new Array(e);for(let n=0;n<e;n++)i[n]=P.createCopy(t[n]);return i},t.minifyConfig=function(t){return b.translateObject(t,!0)},t.unminifyConfig=function(t){return b.translateObject(t,!1)}}(T||(T={})),function(t){let e;!function(t){t.createCopy=function(t){return{width:t.width,height:t.height,left:t.left,top:t.top}},t.defaults={width:null,height:null,left:null,top:null}}(e=t.Window||(t.Window={})),t.createCopy=function(e){return{root:void 0===e.root?void 0:z.createCopy(e.root),openPopouts:T.copyOpenPopouts(e.openPopouts),settings:T.Settings.createCopy(e.settings),dimensions:T.Dimensions.createCopy(e.dimensions),header:T.Header.createCopy(e.header),parentId:e.parentId,indexInParent:e.indexInParent,window:t.Window.createCopy(e.window),resolved:e.resolved}}}(P||(P={})),function(t){t.resolve=function(t,e){switch(t.type){case y.ground:throw new o("ItemConfig cannot specify type ground",JSON.stringify(t));case y.row:case y.column:return H.resolve(t,e);case y.stack:return R.resolve(t,e);case y.component:return W.resolve(t,e);default:throw new h("UCUICR55499",t.type)}},t.resolveContent=function(e){if(void 0===e)return[];{const i=e.length,n=new Array(i);for(let o=0;o<i;o++)n[o]=t.resolve(e[o],!1);return n}},t.resolveId=function(t){return void 0===t?S.defaults.id:Array.isArray(t)?0===t.length?S.defaults.id:t[0]:t},t.resolveSize=function(t,e,i,n){if(void 0!==t)return Q(t,[w.Percent,w.Fractional]);if(void 0!==e||void 0!==i){if(void 0!==e)return{size:e,sizeUnit:w.Percent};if(void 0!==i)return{size:i,sizeUnit:w.Percent};throw new m("CRS33390")}return n?{size:50,sizeUnit:w.Percent}:{size:S.defaults.size,sizeUnit:S.defaults.sizeUnit}},t.resolveMinSize=function(t,e,i){if(void 0!==t)return Q(t,[w.Pixel]);{const t=void 0!==e,n=void 0!==i;return t||n?t?{size:e,sizeUnit:w.Pixel}:{size:i,sizeUnit:w.Pixel}:{size:S.defaults.minSize,sizeUnit:S.defaults.minSizeUnit}}},t.calculateSizeWidthHeightSpecificationType=function(t){return void 0!==t.size?1:void 0!==t.width||void 0!==t.height?2:0},t.isGround=function(t){return t.type===y.ground},t.isRow=function(t){return t.type===y.row},t.isColumn=function(t){return t.type===y.column},t.isStack=function(t){return t.type===y.stack},t.isComponent=function(t){return t.type===y.component}}(A||(A={})),function(t){let e;!function(t){t.resolve=function(t,e){var i;if(void 0!==t||void 0!==e)return{show:null!==(i=null==t?void 0:t.show)&&void 0!==i?i:void 0===e?void 0:!!e&&T.Header.defaults.show,popout:null==t?void 0:t.popout,maximise:null==t?void 0:t.maximise,close:null==t?void 0:t.close,minimise:null==t?void 0:t.minimise,tabDropdown:null==t?void 0:t.tabDropdown}}}(e=t.Header||(t.Header={})),t.resolveIdAndMaximised=function(t){let e,i,n=t.id,o=!1;if(void 0===n)e=S.defaults.id;else if(Array.isArray(n)){const t=n.findIndex((t=>"__glMaximised"===t));t>0&&(o=!0,n=n.splice(t,1)),e=n.length>0?n[0]:S.defaults.id}else e=n;return i=void 0!==t.maximised?t.maximised:o,{id:e,maximised:i}}}(k||(k={})),function(t){function e(t){if(void 0===t)return[];{const e=t.length,i=new Array(e);for(let n=0;n<e;n++){const e=t[n],o=A.resolve(e,!1);if(!S.isComponentItem(o))throw new d("UCUSICRC91114",JSON.stringify(o));i[n]=o}return i}}function i(t){const e=t.length,i=new Array(e);for(let n=0;n<e;n++){const e=t[n];i[n]=W.fromResolved(e)}return i}t.resolve=function(t,i){var n,o;const{id:s,maximised:r}=k.resolveIdAndMaximised(t),{size:a,sizeUnit:l}=A.resolveSize(t.size,t.width,t.height,i),{size:d,sizeUnit:h}=A.resolveMinSize(t.minSize,t.minWidth,t.minHeight);return{type:y.stack,content:e(t.content),size:a,sizeUnit:l,minSize:d,minSizeUnit:h,id:s,maximised:r,isClosable:null!==(n=t.isClosable)&&void 0!==n?n:S.defaults.isClosable,activeItemIndex:null!==(o=t.activeItemIndex)&&void 0!==o?o:x.defaultActiveItemIndex,header:k.Header.resolve(t.header,t.hasHeaders)}},t.fromResolved=function(t){return{type:y.stack,content:i(t.content),size:tt(t.size,t.sizeUnit),minSize:et(t.minSize,t.minSizeUnit),id:t.id,maximised:t.maximised,isClosable:t.isClosable,activeItemIndex:t.activeItemIndex,header:E.Header.createCopy(t.header)}}}(R||(R={})),function(t){t.resolve=function(e,i){var n,o,s;let r=e.componentType;if(void 0===r&&(r=e.componentName),void 0===r)throw new Error("ComponentItemConfig.componentType is undefined");{const{id:a,maximised:l}=k.resolveIdAndMaximised(e);let d;d=void 0===e.title||""===e.title?t.componentTypeToTitle(r):e.title;const{size:h,sizeUnit:c}=A.resolveSize(e.size,e.width,e.height,i),{size:m,sizeUnit:u}=A.resolveMinSize(e.minSize,e.minWidth,e.minHeight);return{type:e.type,content:[],size:h,sizeUnit:c,minSize:m,minSizeUnit:u,id:a,maximised:l,isClosable:null!==(n=e.isClosable)&&void 0!==n?n:S.defaults.isClosable,reorderEnabled:null!==(o=e.reorderEnabled)&&void 0!==o?o:D.defaultReorderEnabled,title:d,header:k.Header.resolve(e.header,e.hasHeaders),componentType:r,componentState:null!==(s=e.componentState)&&void 0!==s?s:{}}}},t.fromResolved=function(t){return{type:y.component,size:tt(t.size,t.sizeUnit),minSize:et(t.minSize,t.minSizeUnit),id:t.id,maximised:t.maximised,isClosable:t.isClosable,reorderEnabled:t.reorderEnabled,title:t.title,header:E.Header.createCopy(t.header),componentType:t.componentType,componentState:J(void 0,t.componentState)}},t.componentTypeToTitle=function(t){switch(typeof t){case"string":return t;case"number":case"boolean":return t.toString();default:return""}}}(W||(W={})),function(t){function e(e){const i=e.length,n=new Array(i);for(let o=0;o<i;o++){const i=e[o],s=i.type;let r;switch(s){case y.row:case y.column:r=t.fromResolved(i);break;case y.stack:r=R.fromResolved(i);break;case y.component:r=W.fromResolved(i);break;default:throw new h("ROCICFRC44797",s)}n[o]=r}return n}t.isChildItemConfig=function(t){switch(t.type){case y.row:case y.column:case y.stack:case y.component:return!0;case y.ground:return!1;default:throw new h("UROCOSPCICIC13687",t.type)}},t.resolve=function(e,i){var n;const{size:o,sizeUnit:s}=A.resolveSize(e.size,e.width,e.height,i),{size:r,sizeUnit:a}=A.resolveMinSize(e.minSize,e.minWidth,e.minHeight);return{type:e.type,content:t.resolveContent(e.content),size:o,sizeUnit:s,minSize:r,minSizeUnit:a,id:A.resolveId(e.id),isClosable:null!==(n=e.isClosable)&&void 0!==n?n:S.defaults.isClosable}},t.fromResolved=function(t){return{type:t.type,content:e(t.content),size:tt(t.size,t.sizeUnit),minSize:et(t.minSize,t.minSizeUnit),id:t.id,isClosable:t.isClosable}},t.resolveContent=function(e){if(void 0===e)return[];{const i=e.length,n=new Array(i);let s,r=!1,a=!1;for(let s=0;s<i;s++){const i=e[s];if(!t.isChildItemConfig(i))throw new o("ItemConfig is not Row, Column or Stack",i);if(!a){const t=A.calculateSizeWidthHeightSpecificationType(i);switch(t){case 0:break;case 2:r=!0;break;case 1:a=!0;break;default:throw new h("ROCICRC87556",t)}}n[s]=i}s=!a&&!!r;const l=new Array(i);for(let t=0;t<i;t++){const e=n[t],i=A.resolve(e,s);if(!L.isChildItemConfig(i))throw new d("UROCOSPIC99512",JSON.stringify(i));l[t]=i}return l}}}(H||(H={})),function(t){t.isRootItemConfig=function(t){switch(t.type){case y.row:case y.column:case y.stack:case y.component:return!0;case y.ground:return!1;default:throw new h("URICIR23687",t.type)}},t.resolve=function(t){if(void 0!==t){const e=A.resolve(t,!1);if(z.isRootItemConfig(e))return e;throw new o("ItemConfig is not Row, Column or Stack",JSON.stringify(t))}},t.fromResolvedOrUndefined=function(t){if(void 0!==t){const e=t.type;switch(e){case y.row:case y.column:return H.fromResolved(t);case y.stack:return R.fromResolved(t);case y.component:return W.fromResolved(t);default:throw new h("RICFROU89921",e)}}}}(U||(U={})),function(t){let e,i,n;function o(t){return"parentId"in t||"indexInParent"in t||"window"in t}!function(t){t.resolve=function(t){var e,i,n,o,s,r,a,l,d,h,c,m,u,p;return{useDragAndDrop:null!==(e=null==t?void 0:t.useDragAndDrop)&&void 0!==e&&e,copyForDragImage:null==t?void 0:t.copyForDragImage,showOldPositionWhenDragging:null!==(i=null==t?void 0:t.showOldPositionWhenDragging)&&void 0!==i?i:T.Settings.defaults.showOldPositionWhenDragging,dragDataMimetype:null!==(n=null==t?void 0:t.dragDataMimetype)&&void 0!==n?n:T.Settings.defaults.dragDataMimetype,checkGlWindowKey:null===(o=null==t?void 0:t.checkGlWindowKey)||void 0===o||o,constrainDragToContainer:null!==(s=null==t?void 0:t.constrainDragToContainer)&&void 0!==s?s:T.Settings.defaults.constrainDragToContainer,reorderEnabled:null!==(r=null==t?void 0:t.reorderEnabled)&&void 0!==r?r:T.Settings.defaults.reorderEnabled,popoutWholeStack:null!==(a=null==t?void 0:t.popoutWholeStack)&&void 0!==a?a:T.Settings.defaults.popoutWholeStack,blockedPopoutsThrowError:null!==(l=null==t?void 0:t.blockedPopoutsThrowError)&&void 0!==l?l:T.Settings.defaults.blockedPopoutsThrowError,closePopoutsOnUnload:null!==(d=null==t?void 0:t.closePopoutsOnUnload)&&void 0!==d?d:T.Settings.defaults.closePopoutsOnUnload,responsiveMode:null!==(h=null==t?void 0:t.responsiveMode)&&void 0!==h?h:T.Settings.defaults.responsiveMode,tabOverlapAllowance:null!==(c=null==t?void 0:t.tabOverlapAllowance)&&void 0!==c?c:T.Settings.defaults.tabOverlapAllowance,reorderOnTabMenuClick:null!==(m=null==t?void 0:t.reorderOnTabMenuClick)&&void 0!==m?m:T.Settings.defaults.reorderOnTabMenuClick,tabControlOffset:null!==(u=null==t?void 0:t.tabControlOffset)&&void 0!==u?u:T.Settings.defaults.tabControlOffset,popInOnClose:null!==(p=null==t?void 0:t.popInOnClose)&&void 0!==p?p:T.Settings.defaults.popInOnClose}}}(e=t.Settings||(t.Settings={})),function(t){t.resolve=function(e){var i,n,o,s,r,a;const{size:l,sizeUnit:d}=t.resolveDefaultMinItemHeight(e),{size:h,sizeUnit:c}=t.resolveDefaultMinItemWidth(e);return{borderWidth:null!==(i=null==e?void 0:e.borderWidth)&&void 0!==i?i:T.Dimensions.defaults.borderWidth,borderGrabWidth:null!==(n=null==e?void 0:e.borderGrabWidth)&&void 0!==n?n:T.Dimensions.defaults.borderGrabWidth,contentInset:null!==(o=null==e?void 0:e.contentInset)&&void 0!==o?o:T.Dimensions.defaults.contentInset,defaultMinItemHeight:l,defaultMinItemHeightUnit:d,defaultMinItemWidth:h,defaultMinItemWidthUnit:c,headerHeight:null!==(s=null==e?void 0:e.headerHeight)&&void 0!==s?s:T.Dimensions.defaults.headerHeight,dragProxyWidth:null!==(r=null==e?void 0:e.dragProxyWidth)&&void 0!==r?r:T.Dimensions.defaults.dragProxyWidth,dragProxyHeight:null!==(a=null==e?void 0:e.dragProxyHeight)&&void 0!==a?a:T.Dimensions.defaults.dragProxyHeight}},t.fromResolved=function(t){return{borderWidth:t.borderWidth,borderGrabWidth:t.borderGrabWidth,defaultMinItemHeight:tt(t.defaultMinItemHeight,t.defaultMinItemHeightUnit),defaultMinItemWidth:tt(t.defaultMinItemWidth,t.defaultMinItemWidthUnit),headerHeight:t.headerHeight,dragProxyWidth:t.dragProxyWidth,dragProxyHeight:t.dragProxyHeight}},t.resolveDefaultMinItemHeight=function(t){const e=null==t?void 0:t.defaultMinItemHeight;return void 0===e?{size:T.Dimensions.defaults.defaultMinItemHeight,sizeUnit:T.Dimensions.defaults.defaultMinItemHeightUnit}:Q(e,[w.Pixel])},t.resolveDefaultMinItemWidth=function(t){const e=null==t?void 0:t.defaultMinItemWidth;return void 0===e?{size:T.Dimensions.defaults.defaultMinItemWidth,sizeUnit:T.Dimensions.defaults.defaultMinItemWidthUnit}:Q(e,[w.Pixel])}}(i=t.Dimensions||(t.Dimensions={})),function(t){t.resolve=function(t,e,i){var n,o,s,r,a,l,d,h,c,m,u,p;let g;return g=void 0!==(null==t?void 0:t.show)?t.show:void 0!==e&&void 0!==e.hasHeaders?!!e.hasHeaders&&T.Header.defaults.show:T.Header.defaults.show,{show:g,popout:null!==(o=null!==(n=null==t?void 0:t.popout)&&void 0!==n?n:null==i?void 0:i.popout)&&void 0!==o?o:!1!==(null==e?void 0:e.showPopoutIcon)&&T.Header.defaults.popout,dock:null!==(r=null!==(s=null==t?void 0:t.popin)&&void 0!==s?s:null==i?void 0:i.popin)&&void 0!==r?r:T.Header.defaults.dock,maximise:null!==(l=null!==(a=null==t?void 0:t.maximise)&&void 0!==a?a:null==i?void 0:i.maximise)&&void 0!==l?l:!1!==(null==e?void 0:e.showMaximiseIcon)&&T.Header.defaults.maximise,close:null!==(h=null!==(d=null==t?void 0:t.close)&&void 0!==d?d:null==i?void 0:i.close)&&void 0!==h?h:!1!==(null==e?void 0:e.showCloseIcon)&&T.Header.defaults.close,minimise:null!==(m=null!==(c=null==t?void 0:t.minimise)&&void 0!==c?c:null==i?void 0:i.minimise)&&void 0!==m?m:T.Header.defaults.minimise,tabDropdown:null!==(p=null!==(u=null==t?void 0:t.tabDropdown)&&void 0!==u?u:null==i?void 0:i.tabDropdown)&&void 0!==p?p:T.Header.defaults.tabDropdown}}}(n=t.Header||(t.Header={})),t.isPopout=o,t.resolve=function(e){if(o(e))return B.resolve(e);{let i;return i=void 0!==e.root?e.root:void 0!==e.content&&e.content.length>0?e.content[0]:void 0,{resolved:!0,root:U.resolve(i),openPopouts:t.resolveOpenPopouts(e.openPopouts),dimensions:t.Dimensions.resolve(e.dimensions),settings:t.Settings.resolve(e.settings),header:t.Header.resolve(e.header,e.settings,e.labels)}}},t.fromResolved=function(e){return{root:U.fromResolvedOrUndefined(e.root),openPopouts:B.fromResolvedArray(e.openPopouts),settings:T.Settings.createCopy(e.settings),dimensions:t.Dimensions.fromResolved(e.dimensions),header:T.Header.createCopy(e.header)}},t.isResolved=function(t){const e=t;return void 0!==e.resolved&&!0===e.resolved},t.resolveOpenPopouts=function(t){if(void 0===t)return[];{const e=t.length,i=new Array(e);for(let n=0;n<e;n++)i[n]=B.resolve(t[n]);return i}}}(O||(O={})),function(t){let e;function i(e){const i=e.length,n=new Array(i);for(let o=0;o<i;o++){const i=e[o];n[o]=t.fromResolved(i)}return n}!function(t){t.resolve=function(t,e){var i,n,o,s,r,a,l,d;let h;const c=P.Window.defaults;return h=void 0!==t?{width:null!==(i=t.width)&&void 0!==i?i:c.width,height:null!==(n=t.height)&&void 0!==n?n:c.height,left:null!==(o=t.left)&&void 0!==o?o:c.left,top:null!==(s=t.top)&&void 0!==s?s:c.top}:{width:null!==(r=null==e?void 0:e.width)&&void 0!==r?r:c.width,height:null!==(a=null==e?void 0:e.height)&&void 0!==a?a:c.height,left:null!==(l=null==e?void 0:e.left)&&void 0!==l?l:c.left,top:null!==(d=null==e?void 0:e.top)&&void 0!==d?d:c.top},h},t.fromResolved=function(t){return{width:null===t.width?void 0:t.width,height:null===t.height?void 0:t.height,left:null===t.left?void 0:t.left,top:null===t.top?void 0:t.top}}}(e=t.Window||(t.Window={})),t.resolve=function(e){var i,n;let o;return o=void 0!==e.root?e.root:void 0!==e.content&&e.content.length>0?e.content[0]:void 0,{root:U.resolve(o),openPopouts:O.resolveOpenPopouts(e.openPopouts),dimensions:O.Dimensions.resolve(e.dimensions),settings:O.Settings.resolve(e.settings),header:O.Header.resolve(e.header,e.settings,e.labels),parentId:null!==(i=e.parentId)&&void 0!==i?i:null,indexInParent:null!==(n=e.indexInParent)&&void 0!==n?n:null,window:t.Window.resolve(e.window,e.dimensions),resolved:!0}},t.fromResolved=function(e){return{root:U.fromResolvedOrUndefined(e.root),openPopouts:i(e.openPopouts),dimensions:O.Dimensions.fromResolved(e.dimensions),settings:T.Settings.createCopy(e.settings),header:T.Header.createCopy(e.header),parentId:e.parentId,indexInParent:e.indexInParent,window:t.Window.fromResolved(e.window)}},t.fromResolvedArray=i}(B||(B={}));class it{constructor(){this._allEventSubscriptions=[],this._subscriptionsMap=new Map,this.unbind=this.removeEventListener,this.trigger=this.emit}tryBubbleEvent(t,e){}emit(t,...e){let i=this._subscriptionsMap.get(t);if(void 0!==i){i=i.slice();for(let t=0;t<i.length;t++)(0,i[t])(...e)}this.emitAllEvent(t,e),this.tryBubbleEvent(t,e)}emitUnknown(t,...e){let i=this._subscriptionsMap.get(t);if(void 0!==i){i=i.slice();for(let t=0;t<i.length;t++)i[t](...e)}this.emitAllEvent(t,e),this.tryBubbleEvent(t,e)}emitBaseBubblingEvent(t){const e=new it.BubblingEvent(t,this);this.emitUnknown(t,e)}emitUnknownBubblingEvent(t){const e=new it.BubblingEvent(t,this);this.emitUnknown(t,e)}removeEventListener(t,e){const i=e;this.removeUnknownEventListener(t,i)}off(t,e){this.removeEventListener(t,e)}addEventListener(t,e){const i=e;this.addUnknownEventListener(t,i)}on(t,e){this.addEventListener(t,e)}addUnknownEventListener(t,e){if(t===it.ALL_EVENT)this._allEventSubscriptions.push(e);else{let i=this._subscriptionsMap.get(t);void 0!==i?i.push(e):(i=[e],this._subscriptionsMap.set(t,i))}}removeUnknownEventListener(t,e){if(t===it.ALL_EVENT)this.removeSubscription(t,this._allEventSubscriptions,e);else{const i=this._subscriptionsMap.get(t);if(void 0===i)throw new Error("No subscribtions to unsubscribe for event "+t);this.removeSubscription(t,i,e)}}removeSubscription(t,e,i){const n=e.indexOf(i);if(n<0)throw new Error("Nothing to unbind for "+t);e.splice(n,1)}emitAllEvent(t,e){const i=this._allEventSubscriptions.length;if(i>0){const n=e.slice();n.unshift(t);const o=this._allEventSubscriptions.slice();for(let t=0;t<i;t++)o[t](...n)}}}!function(t){t.ALL_EVENT="__all",t.headerClickEventName="stackHeaderClick",t.headerTouchStartEventName="stackHeaderTouchStart";class e{constructor(t,e){this._name=t,this._target=e,this._isPropagationStopped=!1}get name(){return this._name}get target(){return this._target}get origin(){return this._target}get isPropagationStopped(){return this._isPropagationStopped}stopPropagation(){this._isPropagationStopped=!0}}t.BubblingEvent=e,t.ClickBubblingEvent=class extends e{constructor(t,e,i){super(t,e),this._mouseEvent=i}get mouseEvent(){return this._mouseEvent}},t.TouchStartBubblingEvent=class extends e{constructor(t,e,i){super(t,e),this._touchEvent=i}get touchEvent(){return this._touchEvent}}}(it||(it={}));class nt extends it{constructor(t,e,i,n,o,s,r,a){if(super(),this._config=t,this._parent=e,this._layoutManager=i,this._updateItemConfigEvent=n,this._showEvent=o,this._hideEvent=s,this._focusEvent=r,this._blurEvent=a,this._stackMaximised=!1,this._element=i.createComponentElement(t,this),this._element){this._element.classList.add("lm_component");const t=this._element.querySelector(".lm_content");this.contentElement=t instanceof HTMLElement?t:this._element}this._width=0,this._height=0,this._visible=!0,this._isShownWithZeroDimensions=!0,this._componentType=t.componentType,this._isClosable=t.isClosable,this._initialState=t.componentState,this._state=this._initialState,this._handle=this.layoutManager.bindComponent(this,t)}get width(){return this._width}get height(){return this._height}get parent(){return this._parent}get componentName(){return this._componentType}get componentType(){return this._componentType}get handle(){return this._handle}get virtual(){return void 0===this._element}get tab(){return this._tab}get title(){return this._parent.title}get layoutManager(){return this._layoutManager}get isHidden(){return!this._visible}get visible(){return this._visible}get state(){return this._state}get initialState(){return this._initialState}get element(){return this._element}destroy(){this.releaseComponent(),this.stateRequestEvent=void 0,this.emit("destroy")}getElement(){return this._element}hide(){this._hideEvent()}show(){this._showEvent()}focus(t=!1){this._focusEvent(t)}blur(t=!1){this._blurEvent(t)}setSize(t,e){let i=this._parent;if(i.isColumn||i.isRow||null===i.parent)throw new d("ICSSPRC","ComponentContainer cannot have RowColumn Parent");{let n;do{n=i,i=i.parent}while(null!==i&&!i.isColumn&&!i.isRow);if(null===i)return!1;{const o=i.isColumn?"height":"width",s=this[o];if(null===s)throw new c("ICSSCS11194");{const r=("height"===o?e:t)/(s*(1/(n.size/100)))*100,a=(n.size-r)/(i.contentItems.length-1);for(let t=0;t<i.contentItems.length;t++){const e=i.contentItems[t];e===n?e.size=r:e.size+=a}return i.updateSize(),!0}}}}close(){this._isClosable&&(this.emit("close"),this._parent.close())}replaceComponent(t){var e,i,n,o;if(this.releaseComponent(),!A.isComponent(t))throw new Error("ReplaceComponent not passed a component ItemConfig");{const s=W.resolve(t,!1);if(this._initialState=s.componentState,this._state=this._initialState,this._componentType=s.componentType,this._updateItemConfigEvent(s),this._handle=this.layoutManager.bindComponent(this,s),this.updateElementPositionPropertyFromBoundComponent(),void 0!==this.virtualVisibilityChangeRequiredEvent&&this.virtualVisibilityChangeRequiredEvent(this,this._visible),void 0!==this.virtualRectingRequiredEvent){null===(i=(e=this._layoutManager).beforeVirtualRectingEvent)||void 0===i||i.call(e,1);try{this.virtualRectingRequiredEvent(this,this._width,this._height)}finally{null===(o=(n=this._layoutManager).afterVirtualRectingEvent)||void 0===o||o.call(n)}}this.setBaseLogicalZIndex(),this.emit("stateChanged")}}getState(){return this._state}extendState(t){const e=Y(this._state,t);this.setState(e)}setState(t){this._state=t,this._parent.emitBaseBubblingEvent("stateChanged")}setTitle(t){this._parent.setTitle(t)}setTitleRenderer(t){this._parent.setTitleRenderer(t)}setTab(t){this._tab=t,this.emit("tab",t)}setVisibility(t){void 0!==this.virtualVisibilityChangeRequiredEvent&&this.virtualVisibilityChangeRequiredEvent(this,t),this._element&&$(this._element,t),t?this._visible?!this._isShownWithZeroDimensions||0===this._height&&0===this._width||(this._isShownWithZeroDimensions=!1,this.parent.updateNodeSize(),this.emitShow()):(this._visible=!0,0===this._height&&0===this._width?this._isShownWithZeroDimensions=!0:(this._isShownWithZeroDimensions=!1,this.parent.updateNodeSize(),this.emitShow())):this._visible&&(this._visible=!1,this._isShownWithZeroDimensions=!1,this.emitHide())}setBaseLogicalZIndex(){this.setLogicalZIndex(_.base)}setLogicalZIndex(t){t!==this._logicalZIndex&&(this._logicalZIndex=t,this.notifyVirtualZIndexChangeRequired())}enterDragMode(t,e){this._width=t,this._height=e,this._element&&(Z(this._element,t),q(this._element,e)),this.setLogicalZIndex(_.drag),this.drag()}exitDragMode(){this.setBaseLogicalZIndex()}enterStackMaximised(){this._stackMaximised=!0,this.setLogicalZIndex(_.stackMaximised)}exitStackMaximised(){this.setBaseLogicalZIndex(),this._stackMaximised=!1}drag(){var t,e,i,n;if(void 0!==this.virtualRectingRequiredEvent){null===(e=(t=this._layoutManager).beforeVirtualRectingEvent)||void 0===e||e.call(t,1);try{this.virtualRectingRequiredEvent(this,this._width,this._height)}finally{null===(n=(i=this._layoutManager).afterVirtualRectingEvent)||void 0===n||n.call(i)}}}notifyVirtualRectingRequired(){if(void 0!==this.virtualRectingRequiredEvent||this.notifyResize){this.virtualRectingRequiredEvent&&this.virtualRectingRequiredEvent(this,this._width,this._height);const t=this.parent.element;if(this.notifyResize&&t){const e=t.getBoundingClientRect();this.notifyResize(this,e.left,e.top,e.width,e.height)}this.emit("resize"),this.checkShownFromZeroDimensions()}}notifyVirtualZIndexChangeRequired(){if(void 0!==this.virtualZIndexChangeRequiredEvent){const t=this._logicalZIndex,e=v[t];this.virtualZIndexChangeRequiredEvent(this,t,e)}}updateElementPositionPropertyFromBoundComponent(){this._element&&(this.virtual?this._element.style.position="static":this._element.style.position="")}checkShownFromZeroDimensions(){!this._isShownWithZeroDimensions||0===this._height&&0===this._width||(this._isShownWithZeroDimensions=!1,this.emitShow())}emitShow(){this.emit("shown"),this.emit("show")}emitHide(){this.emit("hide")}releaseComponent(){this._stackMaximised&&this.exitStackMaximised(),this.emit("beforeComponentRelease",this._handle),this.layoutManager.unbindComponent(this,this._handle)}}class ot extends it{constructor(t,e,i){super(),this._config=t,this._initialWindowSize=e,this._layoutManager=i,this._isInitialised=!1,this._popoutWindow=null,this.createWindow()}toConfig(){var t,e;if(!1===this._isInitialised)throw new Error("Can't create config, layout not yet initialised");const i=this.getGlInstance().saveLayout();let n,o;null===this._popoutWindow?(n=null,o=null):(n=null!==(t=this._popoutWindow.screenX)&&void 0!==t?t:this._popoutWindow.screenLeft,o=null!==(e=this._popoutWindow.screenY)&&void 0!==e?e:this._popoutWindow.screenTop);const s={width:this.getGlInstance().width,height:this.getGlInstance().height,left:n,top:o};return{root:i.root,openPopouts:i.openPopouts,settings:i.settings,dimensions:i.dimensions,header:i.header,window:s,parentId:this._config.parentId,indexInParent:this._config.indexInParent,resolved:!0}}getGlInstance(){if(null===this._popoutWindow)throw new c("BPGGI24693");return this._popoutWindow.__glInstance}getWindow(){if(null===this._popoutWindow)throw new c("BPGW087215");return this._popoutWindow}close(){if(this.getGlInstance())this.getGlInstance().closeWindow();else try{this.getWindow().close()}catch(t){}}popIn(){let t,e=this._config.indexInParent;if(!this._config.parentId)return;const i=Y({},this.getGlInstance().saveLayout()).root;if(void 0===i)throw new m("BPPIR19998");const n=this._layoutManager.groundItem;if(void 0===n)throw new m("BPPIG34972");t=n.getItemsByPopInParentId(this._config.parentId)[0],t||(t=n.contentItems.length>0?n.contentItems[0]:n,e=0);const o=this._layoutManager.createAndInitContentItem(i,t);t.addChild(o,e),this._layoutManager.layoutConfig.settings.popInOnClose?this._onClose():this.close()}createWindow(){const t=this.createUrl(),e=Math.floor(1e6*Math.random()).toString(36),i=this.serializeWindowFeatures({width:this._initialWindowSize.width,height:this._initialWindowSize.height,innerWidth:this._initialWindowSize.width,innerHeight:this._initialWindowSize.height,menubar:"no",toolbar:"no",location:"no",personalbar:"no",resizable:"yes",scrollbars:"no",status:"no"});if(this._popoutWindow=globalThis.open(t,e,i),this._popoutWindow)this._popoutWindow.addEventListener("load",(()=>this.positionWindow()),{passive:!0}),this._popoutWindow.addEventListener("beforeunload",(()=>{this._layoutManager.layoutConfig.settings.popInOnClose?this.popIn():this._onClose()}),{passive:!0}),this._checkReadyInterval=setInterval((()=>this.checkReady()),10);else if(!0===this._layoutManager.layoutConfig.settings.blockedPopoutsThrowError)throw new s("Popout blocked")}checkReady(){if(null===this._popoutWindow)throw new c("BPCR01844");this._popoutWindow.__glInstance&&this._popoutWindow.__glInstance.isInitialised&&(this.onInitialised(),void 0!==this._checkReadyInterval&&(clearInterval(this._checkReadyInterval),this._checkReadyInterval=void 0))}serializeWindowFeatures(t){const e=[];for(const i in t)e.push(i+"="+t[i].toString());return e.join(",")}createUrl(){const t="gl-window-config-"+K(),e=T.minifyConfig(this._config);try{localStorage.setItem(t,JSON.stringify(e))}catch(t){throw new Error("Error while writing to localStorage "+function(t){return t instanceof Error?t.message:"string"==typeof t?t:"Unknown Error"}(t))}const i=new URL(location.href);return i.searchParams.set("gl-window",t),i.toString()}positionWindow(){if(null===this._popoutWindow)throw new Error("BrowserPopout.positionWindow: null popoutWindow");this._popoutWindow.moveTo(this._initialWindowSize.left,this._initialWindowSize.top),this._popoutWindow.focus()}onInitialised(){this._isInitialised=!0,this.getGlInstance().on("popIn",(()=>this.popIn())),this.emit("initialised")}_onClose(){setTimeout((()=>this.emit("closed")),50)}}class st extends it{constructor(t,e,i,n){super(),this.layoutManager=t,this._parent=i,this._element=n,this._popInParentIds=[],this.ignoring=!1,this.ignoringChild=!1,this._type=e.type,this._id=e.id,this._isInitialised=!1,this.isGround=!1,this.isRow=!1,this.isColumn=!1,this.isStack=!1,this.isComponent=!1,this.size=e.size,this.sizeUnit=e.sizeUnit,this.minSize=e.minSize,this.minSizeUnit=e.minSizeUnit,this._isClosable=e.isClosable,this._pendingEventPropagations={},this._throttledEvents=["stateChanged"],this._contentItems=this.createContentItems(e.content)}get type(){return this._type}get id(){return this._id}set id(t){this._id=t}get popInParentIds(){return this._popInParentIds}get parent(){return this._parent}get contentItems(){return this._contentItems}get isClosable(){return this._isClosable}get element(){return this._element}get isInitialised(){return this._isInitialised}static isStack(t){return t.isStack}static isComponentItem(t){return t.isComponent}static isComponentParentableItem(t){return t.isStack||t.isGround}updateSize(){this.layoutManager.beginVirtualSizedContainerAdding();try{this.updateNodeSize(),this.updateContentItemsSize()}finally{this.layoutManager.endVirtualSizedContainerAdding()}}removeChild(t,e=!1){const i=this._contentItems.indexOf(t);if(-1===i)throw new Error("Can't remove child item. Unknown content item");if(e||this._contentItems[i].destroy(),this.layoutManager.deferIfDragging((e=>{this.ignoringChild=!1,t.ignoring=!1,e||this._contentItems.splice(i,1)})),this._contentItems.length>(this.layoutManager.currentlyDragging()?1:0))this.updateSize();else if(!this.isGround&&!0===this._isClosable){if(null===this._parent)throw new c("CIUC00874");this._parent.removeChild(this,e)}}addChild(t,e,i){return null!=e||(e=this._contentItems.length),this._contentItems.splice(e,0,t),t.setParent(this),!0===this._isInitialised&&!1===t._isInitialised&&t.init(),e}replaceChild(t,e,i=!1){const n=this._contentItems.indexOf(t),o=t._element.parentNode;if(-1===n)throw new d("CIRCI23232","Can't replace child. oldChild is not child of this");if(null===o)throw new c("CIRCP23232");if(o.replaceChild(e._element,t._element),!0===i&&(t._parent=null,t.destroy()),this._contentItems[n]=e,e.setParent(this),e.size=t.size,e.sizeUnit=t.sizeUnit,e.minSize=t.minSize,e.minSizeUnit=t.minSizeUnit,null===e._parent)throw new c("CIRCNC45699");!0===e._parent._isInitialised&&!1===e._isInitialised&&e.init(),this.updateSize()}remove(){if(null===this._parent)throw new c("CIR11110");this._parent.removeChild(this)}popout(){const t=K(),e=this.layoutManager.createPopoutFromContentItem(this,void 0,t,void 0);return this.emitBaseBubblingEvent("stateChanged"),e}calculateConfigContent(){const t=this._contentItems,e=t.length,i=new Array(e);for(let n=0;n<e;n++){const e=t[n];i[n]=e.toConfig()}return i}highlightDropZone(t,e,i){const n=this.layoutManager.dropTargetIndicator;if(null===n)throw new c("ACIHDZ5593");n.highlightArea(i,1)}onDrop(t,e){this.addChild(t)}show(){$(this._element,!0),this.layoutManager.updateSizeFromContainer();for(let t=0;t<this._contentItems.length;t++)this._contentItems[t].show()}destroy(){for(let t=0;t<this._contentItems.length;t++)this._contentItems[t].destroy();const t=this._element;t.style.display="none",this.layoutManager.deferIfDragging((e=>{e?t.style.display="":(this._contentItems=[],this.emitBaseBubblingEvent("beforeItemDestroyed"),this._element.remove(),this.emitBaseBubblingEvent("itemDestroyed"))}))}getElementArea(t){const e=(t=null!=t?t:this._element).getBoundingClientRect(),i=e.top+document.body.scrollTop,n=e.left+document.body.scrollLeft,o=e.width,s=e.height;return{x1:n,y1:i,x2:n+o,y2:i+s,surface:o*s,contentItem:this}}init(){this._isInitialised=!0,this.emitBaseBubblingEvent("itemCreated"),this.emitUnknownBubblingEvent(this.type+"Created")}setParent(t){this._parent=t}addPopInParentId(t){this.popInParentIds.includes(t)||this.popInParentIds.push(t)}initContentItems(){for(let t=0;t<this._contentItems.length;t++)this._contentItems[t].init()}hide(){$(this._element,!1),this.layoutManager.updateSizeFromContainer()}updateContentItemsSize(){for(let t=0;t<this._contentItems.length;t++)this._contentItems[t].ignoring||this._contentItems[t].updateSize()}createContentItems(t){const e=t.length,i=new Array(e);for(let e=0;e<t.length;e++)i[e]=this.layoutManager.createContentItem(t[e],this);return i}propagateEvent(t,e){if(1===e.length){const i=e[0];i instanceof it.BubblingEvent&&!1===i.isPropagationStopped&&!0===this._isInitialised&&(!1===this.isGround&&this._parent?this._parent.emitUnknown(t,i):this.scheduleEventPropagationToLayoutManager(t,i))}}tryBubbleEvent(t,e){if(1===e.length){const i=e[0];i instanceof it.BubblingEvent&&!1===i.isPropagationStopped&&!0===this._isInitialised&&(!1===this.isGround&&this._parent?this._parent.emitUnknown(t,i):this.scheduleEventPropagationToLayoutManager(t,i))}}scheduleEventPropagationToLayoutManager(t,e){-1===this._throttledEvents.indexOf(t)?this.layoutManager.emitUnknown(t,e):!0!==this._pendingEventPropagations[t]&&(this._pendingEventPropagations[t]=!0,globalThis.requestAnimationFrame((()=>this.propagateEventToLayoutManager(t,e))))}propagateEventToLayoutManager(t,e){this._pendingEventPropagations[t]=!1,this.layoutManager.emitUnknown(t,e)}}!function(t){t.createElement=function(t){const e=document.createElement("div");return e.classList.add("lm_item"),t&&e.classList.add(t),e}}(st||(st={}));class rt{constructor(t,e,i,n){this._header=t,this._pushEvent=n,this._clickEventListener=t=>this.onClick(t),this._touchStartEventListener=t=>this.onTouchStart(t),this._element=document.createElement("div"),this._element.classList.add(i),this._element.title=e,this._header.on("destroy",(()=>this.destroy())),this._element.addEventListener("click",this._clickEventListener,{passive:!0}),this._element.addEventListener("touchstart",this._touchStartEventListener,{passive:!0}),this._header.controlsContainerElement.appendChild(this._element)}get element(){return this._element}destroy(){var t;this._element.removeEventListener("click",this._clickEventListener),this._element.removeEventListener("touchstart",this._touchStartEventListener),null===(t=this._element.parentNode)||void 0===t||t.removeChild(this._element)}onClick(t){this._pushEvent(t)}onTouchStart(t){this._pushEvent(t)}}class at extends it{constructor(t){super(),this._eElement=t,this._pointerTracking=!1,this._pointerDownEventListener=t=>this.onPointerDown(t),this._pointerMoveEventListener=t=>this.onPointerMove(t),this._pointerUpEventListener=t=>this.onPointerUp(t),this._timeout=void 0,this._oDocument=document,this._eBody=document.body,this._nDelay=1800,this._nDistance=10,this._nX=0,this._nY=0,this._nOriginalX=0,this._nOriginalY=0,this._dragging=!1,this._eElement.addEventListener("pointerdown",this._pointerDownEventListener,{passive:!0})}destroy(){this.checkRemovePointerTrackingEventListeners(),this._eElement.removeEventListener("pointerdown",this._pointerDownEventListener)}cancelDrag(){this.processDragStop(void 0)}onPointerDown(t){for(let e=t.target;;e=e.parentNode){if(!(e instanceof HTMLElement))return;const t=e.getAttribute("draggable");if("true"===t)break;if(null!==t)return}this.processPointerDown(this.getPointerCoordinates(t))}processPointerDown(t){this._nOriginalX=t.x,this._nOriginalY=t.y,this._oDocument.addEventListener("pointermove",this._pointerMoveEventListener),this._oDocument.addEventListener("pointerup",this._pointerUpEventListener,{passive:!0}),this._pointerTracking=!0,this._timeout=setTimeout((()=>{try{this.startDrag()}catch(t){throw console.error(t),t}}),this._nDelay)}onPointerMove(t){this._pointerTracking&&(this.processDragMove(t),t.preventDefault())}processDragMove(t){this._nX=t.pageX-this._nOriginalX,this._nY=t.pageY-this._nOriginalY,!1===this._dragging&&(Math.abs(this._nX)>this._nDistance||Math.abs(this._nY)>this._nDistance)&&this.startDrag(),this._dragging&&this.emit("drag",this._nX,this._nY,t)}onPointerUp(t){this.processDragStop(t)}processDragStop(t){void 0!==this._timeout&&(clearTimeout(this._timeout),this._timeout=void 0),this.checkRemovePointerTrackingEventListeners(),!0===this._dragging&&(this._eBody.classList.remove("lm_dragging"),this._eElement.classList.remove("lm_dragging"),X(!0),this._dragging=!1,this.emit("dragStop",t))}checkRemovePointerTrackingEventListeners(){this._pointerTracking&&(this._oDocument.removeEventListener("pointermove",this._pointerMoveEventListener),this._oDocument.removeEventListener("pointerup",this._pointerUpEventListener),this._pointerTracking=!1)}startDrag(){void 0!==this._timeout&&(clearTimeout(this._timeout),this._timeout=void 0),this._dragging=!0,this._eBody.classList.add("lm_dragging"),this._eElement.classList.add("lm_dragging"),X(!1),this.emit("dragStart",this._nOriginalX,this._nOriginalY)}getPointerCoordinates(t){return{x:t.pageX,y:t.pageY}}}class lt{constructor(t,e,i,n,o){var s;this._layoutManager=t,this._componentItem=e,this._closeEvent=i,this._focusEvent=n,this._dragStartEvent=o,this._isActive=!1,this._tabTouchStartListener=t=>this.onTabTouchStart(t),this._closeClickListener=()=>this.onCloseClick(),this._closeTouchStartListener=()=>this.onCloseTouchStart(),this._dragStartListenerOld=(t,e)=>this.onDragStartOld(t,e),this._dragStartListener=t=>this.onDragStart(t),this._contentItemDestroyListener=()=>this.onContentItemDestroy(),this._tabTitleChangedListener=t=>this.setTitle(t),this.tabClickListener=t=>this.onTabClickDown(t),this._element=document.createElement("div"),this._element.classList.add("lm_tab"),this._titleElement=document.createElement("span"),this._titleElement.classList.add("lm_title"),this._closeElement=document.createElement("div"),this._closeElement.classList.add("lm_close_tab"),this._element.setAttribute("draggable","true"),this._closeElement.setAttribute("draggable","false"),this._element.appendChild(this._titleElement),this._element.appendChild(this._closeElement),e.isClosable?this._closeElement.style.display="":this._closeElement.style.display="none",this.setTitle(e.title),this._componentItem.on("titleChanged",this._tabTitleChangedListener),(null!==(s=e.reorderEnabled)&&void 0!==s?s:this._layoutManager.layoutConfig.settings.reorderEnabled)&&this.enableReorder(),this._element.addEventListener("click",this.tabClickListener,{passive:!0}),this._componentItem.isClosable?(this._closeElement.addEventListener("click",this._closeClickListener,{passive:!0}),this._closeElement.addEventListener("touchstart",this._closeTouchStartListener,{passive:!0})):(this._closeElement.remove(),this._closeElement=void 0),this._componentItem.setTab(this),this._layoutManager.emit("tabCreated",this)}get isActive(){return this._isActive}get componentItem(){return this._componentItem}get contentItem(){return this._componentItem}get element(){return this._element}get titleElement(){return this._titleElement}get closeElement(){return this._closeElement}get reorderEnabled(){return void 0!==this._dragListener}set reorderEnabled(t){t!==this.reorderEnabled&&(t?this.enableReorder():this.disableReorder())}setTitle(t){this._element.title=t;const e=this.componentItem.parent;e instanceof mt&&e.header.updateTabSizes()}setActive(t){t!==this._isActive&&(this._isActive=t,t?this._element.classList.add("lm_active"):this._element.classList.remove("lm_active"))}destroy(){const t=t=>{var e,i;t||(this._closeEvent=void 0,this._focusEvent=void 0,this._dragStartEvent=void 0,this._element.removeEventListener("click",this.tabClickListener),this._element.removeEventListener("touchstart",this._tabTouchStartListener),null===(e=this._closeElement)||void 0===e||e.removeEventListener("click",this._closeClickListener),null===(i=this._closeElement)||void 0===i||i.removeEventListener("touchstart",this._closeTouchStartListener),this._componentItem.off("titleChanged",this._tabTitleChangedListener),this.reorderEnabled&&this.disableReorder())},e=this._layoutManager;e.currentlyDragging()?e.deferIfDragging(t):t(!1),e.deferIfDragging((t=>{t||this._element.remove()}))}setBlurred(){this._element.classList.remove("lm_focused"),this._titleElement.classList.remove("lm_focused")}setFocused(){this._element.classList.add("lm_focused"),this._titleElement.classList.add("lm_focused")}onDragStartOld(t,e){if(void 0===this._dragListener)throw new m("TODSDLU10093");if(void 0===this._dragStartEvent)throw new m("TODS23309");this._dragStartEvent(t,e,this._dragListener,this.componentItem)}onDragStart(t){const e=this._element;document.body.classList.add("lm_dragging"),e.classList.add("lm_dragging"),X(!1),this._layoutManager.startComponentDrag(t,this.componentItem),this._layoutManager.deferIfDragging((t=>{document.body.classList.remove("lm_dragging"),e.classList.remove("lm_dragging")}))}onContentItemDestroy(){void 0!==this._dragListener&&(this._dragListener.destroy(),this._dragListener=void 0)}onTabClickDown(t){const e=t.target;if(e!==this._element)for(let t=e;!t.classList.contains("lm_title");t=t.parentNode)if(t==this._element||t==document.body)return;0===t.button?this.notifyFocus():1===t.button&&this._componentItem.isClosable&&this.notifyClose()}onTabTouchStart(t){t.target===this._element&&this.notifyFocus()}onCloseClick(){this.notifyClose(),this._layoutManager.emit("tabClosed",this._componentItem)}onCloseTouchStart(){this.notifyClose(),this._layoutManager.emit("tabClosed",this._componentItem)}notifyClose(){if(void 0===this._closeEvent)throw new m("TNC15007");this._closeEvent(this._componentItem)}notifyFocus(){if(void 0===this._focusEvent)throw new m("TNA15007");this._focusEvent(this._componentItem)}enableReorder(){var t;this._layoutManager.useNativeDragAndDrop()?this._element.addEventListener("dragstart",this._dragStartListener,{passive:!0}):(this._dragListener=new at(this._element),null===(t=this._dragListener)||void 0===t||t.on("dragStart",this._dragStartListenerOld)),this._componentItem.on("destroy",this._contentItemDestroyListener)}disableReorder(){if(this._layoutManager.useNativeDragAndDrop())this._element.removeEventListener("dragstart",this._dragStartListener);else{if(void 0===this._dragListener)throw new m("TDR87745");this._componentItem.off("destroy",this._contentItemDestroyListener),this._dragListener.off("dragStart",this._dragStartListenerOld),this._dragListener=void 0}}}!function(t){let e;!function(t){t[t.DropdownActive=1]="DropdownActive",t[t.InDropdownMenu=2]="InDropdownMenu",t[t.IsActiveTab=4]="IsActiveTab"}(e=t.RenderFlags||(t.RenderFlags={}))}(lt||(lt={}));class dt{constructor(t,e,i,n,o){this._layoutManager=t,this._componentRemoveEvent=e,this._componentFocusEvent=i,this._componentDragStartEvent=n,this._dropdownActiveChangedEvent=o,this._tabs=[],this._lastVisibleTabIndex=-1,this._dropdownActive=!1,this._element=document.createElement("section"),this._element.classList.add("lm_tabs"),this._dropdownElement=document.createElement("section"),this._dropdownElement.classList.add("lm_tabdropdown_list"),this._dropdownElement.style.display="none"}get tabs(){return this._tabs}get tabCount(){return this._tabs.length}get lastVisibleTabIndex(){return this._lastVisibleTabIndex}get element(){return this._element}get dropdownElement(){return this._dropdownElement}get dropdownActive(){return this._dropdownActive}destroy(){for(let t=0;t<this._tabs.length;t++)this._tabs[t].destroy()}createTab(t,e){for(let e=0;e<this._tabs.length;e++)if(this._tabs[e].componentItem===t)return;const i=new lt(this._layoutManager,t,(t=>this.handleTabCloseEvent(t)),(t=>this.handleTabFocusEvent(t)),((t,e,i,n)=>this.handleTabDragStartEvent(t,e,i,n)));void 0===e&&(e=this._tabs.length),this.markAsSingle(0==this._tabs.length),this._tabs.splice(e,0,i),e<this._element.childNodes.length?this._element.insertBefore(i.element,this._element.childNodes[e]):this._element.appendChild(i.element)}markAsSingle(t){var e,i;const n=null===(i=null===(e=this.element)||void 0===e?void 0:e.parentNode)||void 0===i?void 0:i.parentNode;t?n.classList.add("lm_single"):n.classList.remove("lm_single")}removeTab(t){for(let e=0;e<this._tabs.length;e++)if(this._tabs[e].componentItem===t)return this._tabs[e].destroy(),void this._layoutManager.deferIfDragging((t=>{t||(this._tabs.splice(e,1),this._tabs.length<=1&&this.markAsSingle(!0),e<=this._lastVisibleTabIndex&&--this._lastVisibleTabIndex)}));throw new Error("contentItem is not controlled by this header")}processActiveComponentChanged(t){let e=-1;for(let i=0;i<this._tabs.length;i++){const n=this._tabs[i].componentItem===t;this._tabs[i].setActive(n),n&&(e=i)}if(e<0)throw new d("HSACI56632");if(this._layoutManager.layoutConfig.settings.reorderOnTabMenuClick&&-1!==this._lastVisibleTabIndex&&e>this._lastVisibleTabIndex){const t=this._tabs[e];for(let t=e;t>0;t--)this._tabs[t]=this._tabs[t-1];this._tabs[0]=t}}updateTabSizes(t,e){let i=!1;this.tryUpdateTabSizes(i,t,e)||(i=!0,this.tryUpdateTabSizes(i,t,e)),i!==this._dropdownActive&&(this._dropdownActive=i,this._dropdownActiveChangedEvent())}tryUpdateTabSizes(t,e,i){const n=this.element.parentNode;n.classList.remove("lm_tight_mode");let o=e.availableTabsSize();if(this.element.style.width="",this._tabs.length>0){if(void 0===i)throw new Error("non-empty tabs must have active component item");let s=0;const r=this._layoutManager.layoutConfig.settings.tabOverlapAllowance||(t?6:0),a=this._tabs.indexOf(i.tab),l=this._tabs[a];for(;t&&this._dropdownElement.firstChild;)this._dropdownElement.removeChild(this._dropdownElement.firstChild);const d=V(getComputedStyle(l.element).marginRight);let h,c;const m=this._tabs.length;!t||m<=1?(h=o-d,c=h):(h=(o-m*d)/(m+1),c=2*h);let u=!1;this._lastVisibleTabIndex=m-1;for(let i=0;i<m;i++){const r=this._tabs[i],l=r.element,p=a===i;l.style.marginLeft="",l.style.zIndex="";const g=r.componentItem,f=(t,e,i,n)=>{if(g.titleRenderer)g.titleRenderer(t,e,i,n);else{for(;e.lastChild;)e.removeChild(e.lastChild);e.appendChild(document.createTextNode(g.title))}};if(l.parentElement!==this._element&&this._element.appendChild(l),f(g.container,r.titleElement,p?c:h,(p?lt.RenderFlags.IsActiveTab:0)|(t?lt.RenderFlags.DropdownActive:0)),s=l.offsetLeft-this._element.offsetLeft+l.offsetWidth+d,t){const t=document.createElement("span");t.classList.add("lm_title");const e=.9*o;f(g.container,t,e,(p?lt.RenderFlags.IsActiveTab:0)|lt.RenderFlags.DropdownActive|lt.RenderFlags.InDropdownMenu),this._dropdownElement.appendChild(t),null==t||t.addEventListener("click",r.tabClickListener,{passive:!0})}s>o&&m>1&&!u&&(u=!0,n.classList.add("lm_tight_mode"),o=e.availableTabsSize(),this.element.style.width=N(o),s=l.offsetLeft-this._element.offsetLeft+l.offsetWidth+d)}if(s>o){if(m<=1)return!1;let e=(s-o)/(m-1);if(e>=r){if(!t)return!1;e=r}for(let t=0;t<m;t++){const i=0===t?"":"-"+N(e);this._tabs[t].element.style.zIndex=""+((t<=a?t-a:a-t)+m),this._tabs[t].element.style.marginLeft=i}const i=l.element;if(i.offsetLeft+i.clientWidth>o){if(!t)return!1;if(a>0){const t=Math.max((o-i.clientWidth)/a,0);for(let i=1;i<=a;i++){const n=this._tabs[i].element.offsetLeft-i*t;n>0&&(this._tabs[i].element.style.marginLeft="-"+N(e+n))}}}this._lastVisibleTabIndex=a;for(let t=a+1;t<m;t++){const e=this._tabs[t].element;if(e.offsetLeft+e.offsetWidth>o+r)break;this._lastVisibleTabIndex=t}}}return!0}showAdditionalTabsDropdown(){this._dropdownElement.style.display=""}hideAdditionalTabsDropdown(){this._dropdownElement.style.display="none"}handleTabCloseEvent(t){this._componentRemoveEvent(t)}handleTabFocusEvent(t){this._componentFocusEvent(t)}handleTabDragStartEvent(t,e,i,n){this._componentDragStartEvent(t,e,i,n)}}class ht extends it{constructor(t,e,i,n,o,s,r,a,l,d,h,c,m){super(),this._layoutManager=t,this._parent=e,this._configClosable=n,this._getActiveComponentItemEvent=o,this._popoutEvent=r,this._maximiseToggleEvent=a,this._clickEvent=l,this._touchStartEvent=d,this._componentRemoveEvent=h,this._componentFocusEvent=c,this._componentDragStartEvent=m,this._clickListener=t=>this.onClick(t),this._touchStartListener=t=>this.onTouchStart(t),this._rowColumnClosable=!0,this._closeButton=null,this._popoutButton=null,this._updateRequested=0,this._tabsContainer=new dt(this._layoutManager,(t=>this.handleTabInitiatedComponentRemoveEvent(t)),(t=>this.handleTabInitiatedComponentFocusEvent(t)),((t,e,i,n)=>this.handleTabInitiatedDragStartEvent(t,e,i,n)),(()=>this.processTabDropdownActiveChanged())),this._show=i.show,this._popoutEnabled=i.popoutEnabled,this._popoutLabel=i.popoutLabel,this._maximiseEnabled=i.maximiseEnabled,this._maximiseLabel=i.maximiseLabel,this._minimiseEnabled=i.minimiseEnabled,this._minimiseLabel=i.minimiseLabel,this._closeEnabled=i.closeEnabled,this._closeLabel=i.closeLabel,this._tabDropdownEnabled=i.tabDropdownEnabled,this._tabDropdownLabel=i.tabDropdownLabel,this.setSide(i.side),this._canRemoveComponent=this._configClosable,this._element=document.createElement("section"),this._element.classList.add("lm_header"),this._controlsContainerElement=document.createElement("section"),this._controlsContainerElement.classList.add("lm_controls"),this.layoutDefault(),this._element.addEventListener("click",this._clickListener,{passive:!0}),this._documentMouseUpListener=()=>this._tabsContainer.hideAdditionalTabsDropdown(),globalThis.document.addEventListener("mouseup",this._documentMouseUpListener,{passive:!0}),this._tabControlOffset=this._layoutManager.layoutConfig.settings.tabControlOffset,this._tabDropdownEnabled&&(this._tabDropdownButton=new rt(this,this._tabDropdownLabel,"lm_tabdropdown",(()=>this._tabsContainer.showAdditionalTabsDropdown()))),this._popoutEnabled&&(this._popoutButton=new rt(this,this._popoutLabel,"lm_popout",(t=>this.handleButtonPopoutEvent(t)))),this._maximiseEnabled&&(this._maximiseButton=new rt(this,this._maximiseLabel,"lm_maximise",(t=>this.handleButtonMaximiseToggleEvent(t)))),this._configClosable&&(this._closeButton=new rt(this,this._closeLabel,"lm_close",(()=>s()))),this.processTabDropdownActiveChanged()}get show(){return this._show}get side(){return this._side}get leftRightSided(){return this._leftRightSided}get layoutManager(){return this._layoutManager}get parent(){return this._parent}get tabs(){return this._tabsContainer.tabs}get lastVisibleTabIndex(){return this._tabsContainer.lastVisibleTabIndex}get element(){return this._element}get tabsContainerElement(){return this._tabsContainer.element}get controlsContainerElement(){return this._controlsContainerElement}layoutDefault(){const t=this._element;for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(this._tabsContainer.element),t.appendChild(this._controlsContainerElement),t.appendChild(this._tabsContainer.dropdownElement)}destroy(){this._element.style.opacity="0",this.layoutManager.deferIfDragging((t=>{t?this._element.style.opacity="":(this.emit("destroy"),this._popoutEvent=void 0,this._maximiseToggleEvent=void 0,this._clickEvent=void 0,this._touchStartEvent=void 0,this._componentRemoveEvent=void 0,this._componentFocusEvent=void 0,this._componentDragStartEvent=void 0,this._tabsContainer.destroy(),globalThis.document.removeEventListener("mouseup",this._documentMouseUpListener),this._element.remove())}))}createTab(t,e){this._tabsContainer.createTab(t,e)}removeTab(t){this._tabsContainer.removeTab(t)}processActiveComponentChanged(t){this._tabsContainer.processActiveComponentChanged(t),this.updateTabSizes()}setSide(t){this._side=t,this._leftRightSided=[f.right,f.left].includes(this._side)}setRowColumnClosable(t){this._rowColumnClosable=t,this.updateClosability()}updateClosability(){let t;if(this._configClosable)if(this._rowColumnClosable){t=!0;const e=this.tabs.length;for(let i=0;i<e;i++)if(!this._tabsContainer.tabs[i].componentItem.isClosable){t=!1;break}}else t=!1;else t=!1;null!==this._closeButton&&$(this._closeButton.element,t),null!==this._popoutButton&&$(this._popoutButton.element,t),this._canRemoveComponent=t||this._tabsContainer.tabCount>1}applyFocusedValue(t){t?this._element.classList.add("lm_focused"):this._element.classList.remove("lm_focused")}processMaximised(){if(void 0===this._maximiseButton)throw new m("HPMAX16997");this._maximiseButton.element.setAttribute("title",this._minimiseLabel)}processMinimised(){if(void 0===this._maximiseButton)throw new m("HPMIN16997");this._maximiseButton.element.setAttribute("title",this._maximiseLabel)}updateTabSizes(){this._updateRequested||(this._updateRequested=window.requestAnimationFrame((()=>{this._updateRequested=0,this._tabsContainer.tabCount>0&&this._tabsContainer.updateTabSizes(this,this._getActiveComponentItemEvent())})))}availableTabsSize(){const t=this._element;let e=this._leftRightSided?t.offsetHeight:t.offsetWidth;for(let i=t.firstElementChild;i;i=i.nextElementSibling)i!==this.tabsContainerElement&&i instanceof HTMLElement&&(e-=this._leftRightSided?i.offsetHeight:i.offsetWidth);return e}handleTabInitiatedComponentRemoveEvent(t){if(this._canRemoveComponent){if(void 0===this._componentRemoveEvent)throw new m("HHTCE22294");this._componentRemoveEvent(t)}}handleTabInitiatedComponentFocusEvent(t){if(void 0===this._componentFocusEvent)throw new m("HHTAE22294");this._componentFocusEvent(t)}handleTabInitiatedDragStartEvent(t,e,i,n){if(this._canRemoveComponent){if(void 0===this._componentDragStartEvent)throw new m("HHTDSE22294");this._componentDragStartEvent(t,e,i,n)}else i.cancelDrag()}processTabDropdownActiveChanged(){void 0!==this._tabDropdownButton&&$(this._tabDropdownButton.element,this._tabsContainer.dropdownActive)}handleButtonPopoutEvent(t){if(!this._layoutManager.popoutClickHandler(this.parent,t))if(this._layoutManager.layoutConfig.settings.popoutWholeStack){if(void 0===this._popoutEvent)throw new m("HHBPOE17834");this._popoutEvent()}else{const t=this._getActiveComponentItemEvent();t&&t.popout()}}handleButtonMaximiseToggleEvent(t){if(void 0===this._maximiseToggleEvent)throw new m("HHBMTE16834");this._maximiseToggleEvent()}onClick(t){t.target===this._element&&this.notifyClick(t)}onTouchStart(t){t.target===this._element&&this.notifyTouchStart(t)}notifyClick(t){if(void 0===this._clickEvent)throw new m("HNHC46834");this._clickEvent(t)}notifyTouchStart(t){if(void 0===this._touchStartEvent)throw new m("HNHTS46834");this._touchStartEvent(t)}}class ct extends st{constructor(){super(...arguments),this._focused=!1}get focused(){return this._focused}setFocusedValue(t){this._focused=t}}class mt extends ct{constructor(t,e,i){var n,o,s,r,a,l,d,h,c,m,u,p,g,_,v,C,y,I,w;super(t,e,i,st.createElement("lm_stack")),this._headerSideChanged=!1,this._resizeListener=()=>this.updateTabSizes(),this._maximisedListener=()=>this.handleMaximised(),this._minimisedListener=()=>this.handleMinimised(),this._headerConfig=e.header;const b=t.layoutConfig.header,S=e.content;let E;E=1!==S.length?void 0:S[0].header,this._initialWantMaximise=e.maximised,this._initialActiveItemIndex=null!==(n=e.activeItemIndex)&&void 0!==n?n:0;const x=null!==(r=null!==(s=null===(o=this._headerConfig)||void 0===o?void 0:o.show)&&void 0!==s?s:null==E?void 0:E.show)&&void 0!==r?r:b.show,D=null!==(d=null!==(l=null===(a=this._headerConfig)||void 0===a?void 0:a.popout)&&void 0!==l?l:null==E?void 0:E.popout)&&void 0!==d?d:b.popout,L=null!==(m=null!==(c=null===(h=this._headerConfig)||void 0===h?void 0:h.maximise)&&void 0!==c?c:null==E?void 0:E.maximise)&&void 0!==m?m:b.maximise,z=null!==(g=null!==(p=null===(u=this._headerConfig)||void 0===u?void 0:u.close)&&void 0!==p?p:null==E?void 0:E.close)&&void 0!==g?g:b.close,M=null!==(C=null!==(v=null===(_=this._headerConfig)||void 0===_?void 0:_.minimise)&&void 0!==v?v:null==E?void 0:E.minimise)&&void 0!==C?C:b.minimise,T=null!==(w=null!==(I=null===(y=this._headerConfig)||void 0===y?void 0:y.tabDropdown)&&void 0!==I?I:null==E?void 0:E.tabDropdown)&&void 0!==w?w:b.tabDropdown;this._maximisedEnabled=!1!==L;const P={show:!1!==x,side:!1===x?f.top:x,popoutEnabled:!1!==D,popoutLabel:!1===D?"":D,maximiseEnabled:this._maximisedEnabled,maximiseLabel:!1===L?"":L,closeEnabled:!1!==z,closeLabel:!1===z?"":z,minimiseEnabled:!0,minimiseLabel:M,tabDropdownEnabled:!1!==T,tabDropdownLabel:!1===T?"":T};this._header=new ht(t,this,P,e.isClosable&&!1!==z,(()=>this.getActiveComponentItem()),(()=>this.remove()),(()=>this.handlePopoutEvent()),(()=>this.toggleMaximise()),(t=>this.handleHeaderClickEvent(t)),(t=>this.handleHeaderTouchStartEvent(t)),(t=>this.handleHeaderComponentRemoveEvent(t)),(t=>this.handleHeaderComponentFocusEvent(t)),((t,e,i,n)=>this.handleHeaderComponentStartDragEvent(t,e,i,n))),this.isStack=!0,this._childElementContainer=document.createElement("section"),this._childElementContainer.classList.add("lm_items"),this.on("resize",this._resizeListener),this._maximisedEnabled&&(this.on("maximised",this._maximisedListener),this.on("minimised",this._minimisedListener)),this.element.appendChild(this._header.element),this.element.appendChild(this._childElementContainer),this.setupHeaderPosition(),this._header.updateClosability()}get childElementContainer(){return this._childElementContainer}get header(){return this._header}get headerShow(){return this._header.show}get headerSide(){return this._header.side}get headerLeftRightSided(){return this._header.leftRightSided}get contentAreaDimensions(){return this._contentAreaDimensions}get initialWantMaximise(){return this._initialWantMaximise}get isMaximised(){return this===this.layoutManager.maximisedStack}get stackParent(){if(!this.parent)throw new Error("Stack should always have a parent");return this.parent}init(){if(!0===this.isInitialised)return;this.updateNodeSize();for(let t=0;t<this.contentItems.length;t++)this._childElementContainer.appendChild(this.contentItems[t].element);super.init();const t=this.contentItems,e=t.length;if(e>0){if(this._initialActiveItemIndex<0||this._initialActiveItemIndex>=e)throw new Error(`ActiveItemIndex out of range: ${this._initialActiveItemIndex} id: ${this.id}`);for(let i=0;i<e;i++){const e=t[i];if(!(e instanceof ut))throw new Error(`Stack Content Item is not of type ComponentItem: ${i} id: ${this.id}`);this._header.createTab(e,i),e.hide(),e.container.setBaseLogicalZIndex()}this.setActiveComponentItem(t[this._initialActiveItemIndex],!1),this.updateTabSizes()}this._header.updateClosability(),this.initContentItems()}setActiveContentItem(t){if(!st.isComponentItem(t))throw new Error("Stack.setActiveContentItem: item is not a ComponentItem");this.setActiveComponentItem(t,!1)}setActiveComponentItem(t,e,i=!1){if(this._activeComponentItem!==t){if(-1===this.contentItems.indexOf(t))throw new Error("componentItem is not a child of this stack");void 0!==this._activeComponentItem&&this._activeComponentItem.hide(),this._activeComponentItem=t,this._header.processActiveComponentChanged(t),t.show(),this.emit("activeContentItemChanged",t),this.layoutManager.emit("activeContentItemChanged",t),this.emitStateChangedEvent()}(this.focused||e)&&this.layoutManager.setFocusedComponentItem(t,i)}getActiveContentItem(){var t;return null!==(t=this.getActiveComponentItem())&&void 0!==t?t:null}getActiveComponentItem(){return this._activeComponentItem}focusActiveContentItem(){var t;null===(t=this._activeComponentItem)||void 0===t||t.focus()}setFocusedValue(t){t?this.element.classList.add("lm_focused"):this.element.classList.remove("lm_focused"),this._header.applyFocusedValue(t),super.setFocusedValue(t)}setRowColumnClosable(t){this._header.setRowColumnClosable(t)}newComponent(t,e,i,n){const o={type:"component",componentType:t,componentState:e,title:i};return this.newItem(o,n)}addComponent(t,e,i,n){const o={type:"component",componentType:t,componentState:e,title:i};return this.addItem(o,n)}newItem(t,e){return e=this.addItem(t,e),this.contentItems[e]}addItem(t,e){this.layoutManager.checkMinimiseMaximisedStack();const i=A.resolve(t,!1),n=this.layoutManager.createAndInitContentItem(i,this);return this.addChild(n,e)}addChild(t,e,i=!1){if(void 0!==e&&e>this.contentItems.length)throw e-=1,new d("SAC99728");if(t instanceof ut)return e=super.addChild(t,e),this._childElementContainer.appendChild(t.element),this._header.createTab(t,e),this.setActiveComponentItem(t,i),this._header.updateTabSizes(),this.updateSize(),t.container.setBaseLogicalZIndex(),this._header.updateClosability(),this.emitStateChangedEvent(),e;throw new d("SACC88532")}removeChild(t,e){const i=t,n=this.contentItems.indexOf(i),o=1===this.contentItems.length;if(this._activeComponentItem===i&&(i.focused&&i.blur(),!o)){const t=0===n?1:n-1;this.setActiveComponentItem(this.contentItems[t],!1)}this._header.removeTab(i),super.removeChild(i,e),o||this._header.updateClosability(),this.emitStateChangedEvent()}toggleMaximise(){this.isMaximised?this.minimise():this.maximise()}maximise(){if(!this.isMaximised){this.layoutManager.setMaximisedStack(this);const t=this.contentItems,e=t.length;for(let i=0;i<e;i++){const e=t[i];if(!(e instanceof ut))throw new d("SMAXI87773");e.enterStackMaximised()}this.emitStateChangedEvent()}}minimise(){if(this.isMaximised){this.layoutManager.setMaximisedStack(void 0);const t=this.contentItems,e=t.length;for(let i=0;i<e;i++){const e=t[i];if(!(e instanceof ut))throw new d("SMINI87773");e.exitStackMaximised()}this.emitStateChangedEvent()}}destroy(){var t;(null===(t=this._activeComponentItem)||void 0===t?void 0:t.focused)&&this._activeComponentItem.blur(),super.destroy(),this.off("resize",this._resizeListener),this._maximisedEnabled&&(this.off("maximised",this._maximisedListener),this.off("minimised",this._minimisedListener)),this._header.destroy()}toConfig(){let t;if(this._activeComponentItem&&(t=this.contentItems.indexOf(this._activeComponentItem),t<0))throw new Error("active component item not found in stack");if(this.contentItems.length>0&&void 0===t)throw new Error("expected non-empty stack to have an active component item");return{type:"stack",content:this.calculateConfigContent(),size:this.size,sizeUnit:this.sizeUnit,minSize:this.minSize,minSizeUnit:this.minSizeUnit,id:this.id,isClosable:this.isClosable,maximised:this.isMaximised,header:this.createHeaderConfig(),activeItemIndex:t}}onDrop(t,e){if("header"===this._dropSegment){if(this.resetHeaderDropZone(),void 0===this._dropIndex)throw new m("SODDI68990");return void this.addChild(t,this._dropIndex)}if("body"===this._dropSegment)return void this.addChild(t,0,!0);const i="top"===this._dropSegment||"bottom"===this._dropSegment,n="left"===this._dropSegment||"right"===this._dropSegment,o="top"===this._dropSegment||"left"===this._dropSegment,s=i&&this.stackParent.isColumn||n&&this.stackParent.isRow;if(t.isComponent){const e=x.createDefault();e.header=this.createHeaderConfig();const i=this.layoutManager.createAndInitContentItem(e,this);i.addChild(t),t=i}if(t.type===y.row||t.type===y.column){const e=x.createDefault();e.header=this.createHeaderConfig();const i=this.layoutManager.createContentItem(e,this);i.addChild(t),t=i}if(s){const e=this.stackParent.contentItems.indexOf(this);this.stackParent.addChild(t,o?e:e+1,!0),this.size*=.5,t.size=this.size,t.sizeUnit=this.sizeUnit,this.stackParent.updateSize()}else{const e=i?y.column:y.row,n=S.createDefault(e),s=this.layoutManager.createContentItem(n,this);this.stackParent.replaceChild(this,s),s.addChild(t,o?0:void 0,!0),s.addChild(this,o?void 0:0,!0),this.size=50,t.size=50,t.sizeUnit=w.Percent,s.updateSize()}}highlightDropZone(t,e){for(const i in this._contentAreaDimensions){const n=i,o=this._contentAreaDimensions[n].hoverArea;if(o.x1<t&&o.x2>t&&o.y1<e&&o.y2>e)return void("header"===n?(this._dropSegment="header",this.highlightHeaderDropZone(this._header.leftRightSided?e:t)):(this.resetHeaderDropZone(),this.highlightBodyDropZone(n)))}}getArea(){if("none"===this.element.style.display)return null;const t=super.getElementArea(this._header.element),e=super.getElementArea(this._childElementContainer);if(null===t||null===e)throw new c("SGAHC13086");const i=e.x2-e.x1,n=e.y2-e.y1;return this._contentAreaDimensions={header:{hoverArea:{x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2},highlightArea:{x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}}},0===this.contentItems.length?(this._contentAreaDimensions.body={hoverArea:{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2},highlightArea:{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2}},super.getElementArea(this.element)):(this._contentAreaDimensions.left={hoverArea:{x1:e.x1,y1:e.y1,x2:e.x1+.25*i,y2:e.y2},highlightArea:{x1:e.x1,y1:e.y1,x2:e.x1+.5*i,y2:e.y2}},this._contentAreaDimensions.top={hoverArea:{x1:e.x1+.25*i,y1:e.y1,x2:e.x1+.75*i,y2:e.y1+.5*n},highlightArea:{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y1+.5*n}},this._contentAreaDimensions.right={hoverArea:{x1:e.x1+.75*i,y1:e.y1,x2:e.x2,y2:e.y2},highlightArea:{x1:e.x1+.5*i,y1:e.y1,x2:e.x2,y2:e.y2}},this._contentAreaDimensions.bottom={hoverArea:{x1:e.x1+.25*i,y1:e.y1+.5*n,x2:e.x1+.75*i,y2:e.y2},highlightArea:{x1:e.x1,y1:e.y1+.5*n,x2:e.x2,y2:e.y2}},super.getElementArea(this.element))}positionHeader(t){this._header.side!==t&&(this._header.setSide(t),this._headerSideChanged=!0,this.setupHeaderPosition())}updateNodeSize(){"none"!==this.element.style.display&&(this.emit("resize"),this.emitStateChangedEvent())}highlightHeaderDropZone(t){var e;const i=this.layoutManager.tabDropPlaceholder;i.remove();const n=this._header.tabsContainerElement.childNodes,o=n.length,s=this.layoutManager.dropTargetIndicator;if(null===s)throw new c("SHHDZDTI97110");let r;if(0===o){const t=this._header.element.getBoundingClientRect(),e=t.top+document.body.scrollTop,i=t.left+document.body.scrollLeft;r={x1:i,x2:i+100,y1:e+t.height-20,y2:e+t.height},this._dropIndex=0}else{let s,a,l,d,h=0,c=!1,m=0;do{d=n[h];const e=d.getBoundingClientRect(),i=e.top+document.body.scrollTop,o=e.left+document.body.scrollLeft;this._header.leftRightSided?(a=i,s=o,l=e.height):(a=o,s=i,l=e.width),d.classList.contains("lm_dragging")&&m++,t>=a&&t<a+l?c=!0:h++}while(h<o&&!c);if(!1===c&&t<a)return;const u=t>=a+l/2;this._dropIndex=h+(h<o&&u?1:0)-m,null===(e=d.parentNode)||void 0===e||e.insertBefore(i,u?d.nextSibling:d);const p=this.layoutManager.tabDropPlaceholder.getBoundingClientRect(),g=p.top+document.body.scrollTop,f=p.left+document.body.scrollLeft,_=p.width;if(this._header.leftRightSided){const t=g;r={x1:s,x2:s+d.clientHeight,y1:t,y2:t+_}}else r={x1:f,x2:f+_,y1:s,y2:s+d.clientHeight}}s.highlightArea(r,0)}resetHeaderDropZone(){this.layoutManager.tabDropPlaceholder.remove()}setupHeaderPosition(){$(this._header.element,this._header.show),this.element.classList.remove("lm_left","lm_right","lm_bottom"),this._header.leftRightSided&&this.element.classList.add("lm_"+this._header.side),this.updateSize()}highlightBodyDropZone(t){if(void 0===this._contentAreaDimensions)throw new m("SHBDZC82265");{const e=this._contentAreaDimensions[t].highlightArea,i=this.layoutManager.dropTargetIndicator;if(null===i)throw new c("SHBDZD96110");i.highlightArea(e,1),this._dropSegment=t}}updateTabSizes(){this._header&&this._header.updateTabSizes()}handleMaximised(){this._header.processMaximised()}handleMinimised(){this._header.processMinimised()}handlePopoutEvent(){this.popout()}handleHeaderClickEvent(t){this._activeComponentItem&&this.setActiveComponentItem(this._activeComponentItem,!0);const e=it.headerClickEventName,i=new it.ClickBubblingEvent(e,this,t);this.emit(e,i)}handleHeaderTouchStartEvent(t){const e=it.headerTouchStartEventName,i=new it.TouchStartBubblingEvent(e,this,t);this.emit(e,i)}handleHeaderComponentRemoveEvent(t){this.removeChild(t,!1)}handleHeaderComponentFocusEvent(t){this.setActiveComponentItem(t,!0)}handleHeaderComponentStartDragEvent(t,e,i,n){!0===this.isMaximised&&this.toggleMaximise(),this.layoutManager.startComponentDragOld(t,e,i,n,this)}createHeaderConfig(){if(this._headerSideChanged){const t=!!this._header.show&&this._header.side;let e=E.Header.createCopy(this._headerConfig,t);return void 0===e&&(e={show:t,popout:void 0,maximise:void 0,close:void 0,minimise:void 0,tabDropdown:void 0}),e}return E.Header.createCopy(this._headerConfig)}emitStateChangedEvent(){this.emitBaseBubblingEvent("stateChanged")}}class ut extends st{constructor(t,e,i){super(t,e,i,st.createElement()),this._parentItem=i,this._focused=!1,this.isComponent=!0,this._reorderEnabled=e.reorderEnabled,this.applyUpdatableConfig(e),this._initialWantMaximise=e.maximised,this._container=new nt(e,this,t,(t=>this.handleUpdateItemConfigEvent(t)),(()=>this.show()),(()=>this.hide()),(t=>this.focus(t)),(t=>this.blur(t)))}get componentName(){return this._container.componentType}get componentType(){return this._container.componentType}get reorderEnabled(){return this._reorderEnabled}get initialWantMaximise(){return this._initialWantMaximise}get container(){return this._container}get parentItem(){return this._parentItem}get headerConfig(){return this._headerConfig}get title(){return this._title}get titleRenderer(){return this._titleRenderer}get tab(){return this._tab}get focused(){return this._focused}destroy(){const t=this.element;t&&(t.style.opacity="0.1");const e=this.layoutManager.currentlyDragging();this.layoutManager.deferIfDragging((i=>{t&&(t.style.opacity=""),i||e||(this._container.destroy(),super.destroy())}))}applyUpdatableConfig(t){this.setTitle(t.title),this._headerConfig=t.header}toConfig(){const t=this._container.stateRequestEvent,e=void 0===t?this._container.state:t();return{type:y.component,content:[],size:this.size,sizeUnit:this.sizeUnit,minSize:this.minSize,minSizeUnit:this.minSizeUnit,id:this.id,maximised:!1,isClosable:this.isClosable,reorderEnabled:this._reorderEnabled,title:this._title,header:E.Header.createCopy(this._headerConfig),componentType:D.copyComponentType(this.componentType),componentState:e}}close(){if(null===this.parent)throw new c("CIC68883");this.parent.removeChild(this,!1)}enterDragMode(t,e){const i=this.element.style;i.height=`${e}px`,i.width=`${t}px`,this._container.enterDragMode(t,e)}exitDragMode(){const t=this.element.style;t.height="",t.width="",this._container.exitDragMode()}enterStackMaximised(){this._container.enterStackMaximised()}exitStackMaximised(){this._container.exitStackMaximised()}drag(){this._container.drag()}init(){this.updateNodeSize(),super.init(),this._container.emit("open"),this.initContentItems()}setTitle(t){this._title=t,this.emit("titleChanged",t),this.emit("stateChanged")}setTitleRenderer(t){this._titleRenderer=t,this.emit("titleChanged",this._title),this.emit("stateChanged")}setTab(t){this._tab=t,this.emit("tab",t),this._container.setTab(t)}hide(){this._container.setVisibility(!1)}show(){this._container.setVisibility(!0)}focus(t=!1){this.parentItem.setActiveComponentItem(this,!0,t)}setFocused(t){this._focused=!0,this.tab.setFocused(),t||this.emitBaseBubblingEvent("focus")}blur(t=!1){this._focused&&this.layoutManager.setFocusedComponentItem(void 0,t)}setBlurred(t){this._focused=!1,this.tab.setBlurred(),t||this.emitBaseBubblingEvent("blur")}setParent(t){this._parentItem=t,super.setParent(t)}handleUpdateItemConfigEvent(t){this.applyUpdatableConfig(t)}updateNodeSize(){const t=this.layoutManager.layoutConfig.dimensions.contentInset;this.element.style.margin=t?`${t}px`:"";const e=this.container.contentElement,i=this.container.element;if(e instanceof HTMLElement&&this.parentItem instanceof mt){const t=this.parentItem.element;let n;const o=this.element.getBoundingClientRect(),s=this.layoutManager.container.getBoundingClientRect();i instanceof HTMLElement&&e!==i?(n=t.getBoundingClientRect(),i.style.top=N(n.top-s.top),i.style.left=N(n.left-s.left),i.style.width=N(n.width),i.style.height=N(n.height)):n=s,e.style.position="absolute",e.style.top=N(o.top-n.top),e.style.left=N(o.left-n.left),e.style.width=N(o.width),e.style.height=N(o.height)}else console.log("updateNodeSize ignored");this.layoutManager.addVirtualSizedContainer(this.container)}}class pt{constructor(t,e,i){this._isVertical=t,this._size=e,this._grabSize=i<this._size?this._size:i,this._element=document.createElement("div"),this._element.classList.add("lm_splitter"),this._backgroundElement=document.createElement("div");const n=document.createElement("div");this._dragHandleElement=n,n.classList.add("lm_drag_handle"),this._backgroundElement.classList.add("lm_bg"),this._element.setAttribute("draggable","true");const o=(this._grabSize-this._size)/2;this._dragHandleOffset=o;const s=N(o);this._isVertical?(n.style.top=-o+"px",n.style.paddingTop=s,n.style.paddingBottom=s,n.style.height=N(this._size),this._backgroundElement.style.top=-o+"px",this._backgroundElement.style.height=`${this._grabSize}px`,this._element.classList.add("lm_vertical"),this._element.style.height=N(this._size)):(n.style.left=-o+"px",n.style.paddingLeft=s,n.style.paddingRight=s,n.style.width=N(this._size),this._backgroundElement.style.left=-o+"px",this._backgroundElement.style.width=`${this._grabSize}px`,this._element.classList.add("lm_horizontal"),this._element.style.width=N(this._size)),this._element.appendChild(this._backgroundElement),this._element.appendChild(n),this._dragListener=new at(this._element)}get element(){return this._element}get dragHandleElement(){return this._dragHandleElement}get backgroundElement(){return this._backgroundElement}get dragHandleOffset(){return this._dragHandleOffset}destroy(){this._element.remove()}on(t,e){this._dragListener.on(t,e)}}class gt extends st{constructor(t,e,i,n){switch(super(e,i,n,st.createElement(t?"lm_column":"lm_row")),this._rowOrColumnParent=n,this._splitter=[],this.isRow=!t,this.isColumn=t,this._childElementContainer=this.element,this._splitterSize=e.layoutConfig.dimensions.borderWidth,this._splitterGrabSize=e.layoutConfig.dimensions.borderGrabWidth,this._isColumn=t,this._dimension=t?"height":"width",this._splitterPosition=null,this._splitterMinPosition=null,this._splitterMaxPosition=null,i.type){case y.row:case y.column:this._configType=i.type;break;default:throw new d("ROCCCT00925")}}newComponent(t,e,i,n){const o={type:"component",componentType:t,componentState:e,title:i};return this.newItem(o,n)}addComponent(t,e,i,n){const o={type:"component",componentType:t,componentState:e,title:i};return this.addItem(o,n)}newItem(t,e){e=this.addItem(t,e);const i=this.contentItems[e];return st.isStack(i)&&A.isComponent(t)?i.contentItems[0]:i}addItem(t,e){this.layoutManager.checkMinimiseMaximisedStack();const i=A.resolve(t,!1),n=this.layoutManager.createAndInitContentItem(i,this);return this.addChild(n,e,!1)}addChild(t,e,i){if(void 0===e&&(e=this.contentItems.length),this.contentItems.length>0){const i=this.createSplitter(Math.max(0,e-1)).element;e>0?(this.contentItems[e-1].element.insertAdjacentElement("afterend",i),i.insertAdjacentElement("afterend",t.element)):(this.contentItems[0].element.insertAdjacentElement("beforebegin",i),i.insertAdjacentElement("beforebegin",t.element))}else this._childElementContainer.appendChild(t.element);super.addChild(t,e);const n=1/this.contentItems.length*100;if(!0===i)return this.emitBaseBubblingEvent("stateChanged"),e;for(let e=0;e<this.contentItems.length;e++){const i=this.contentItems[e];if(i===t)t.size=n;else{const t=i.size*=(100-n)/100;i.size=t}}return this.updateSize(),this.emitBaseBubblingEvent("stateChanged"),e}removeChild(t,e){const i=this.contentItems.indexOf(t),n=Math.max(i-1,0);if(-1===i)throw new Error("Can't remove child. ContentItem is not child of this Row or Column");const o=this._splitter[n];o&&(o.element.style.display="none",this.layoutManager.deferIfDragging((t=>{t?o.element.style.display="":(o.destroy(),this._splitter.splice(n,1))}))),super.removeChild(t,e),this.layoutManager.deferIfDragging((t=>{if(!t&&1===this.contentItems.length&&!0===this.isClosable){const t=this.contentItems[0];return this.contentItems.length=0,void this._rowOrColumnParent.replaceChild(this,t,!0)}this.updateSize(),this.emitBaseBubblingEvent("stateChanged")})),this.layoutManager.currentlyDragging()&&this.updateSize()}replaceChild(t,e){const i=t.size;super.replaceChild(t,e),e.size=i,this.updateSize(),this.emitBaseBubblingEvent("stateChanged")}init(){if(!0!==this.isInitialised){this.updateNodeSize();for(let t=0;t<this.contentItems.length;t++)this._childElementContainer.appendChild(this.contentItems[t].element);super.init();for(let t=0;t<this.contentItems.length-1;t++)this.contentItems[t].element.insertAdjacentElement("afterend",this.createSplitter(t).element);this.initContentItems()}}toConfig(){return{type:this.type,content:this.calculateConfigContent(),size:this.size,sizeUnit:this.sizeUnit,minSize:this.minSize,minSizeUnit:this.minSizeUnit,id:this.id,isClosable:this.isClosable}}setParent(t){this._rowOrColumnParent=t,super.setParent(t)}updateNodeSize(){this.contentItems.length>0&&(this.calculateRelativeSizes(),this.setAbsoluteSizes()),this.emitBaseBubblingEvent("stateChanged"),this.emit("resize")}setAbsoluteSizes(){const t=this.calculateAbsoluteSizes();for(let e=0;e<this.contentItems.length;e++){const i=this.contentItems[e];i.ignoring||(t.additionalPixel-e>0&&t.itemSizes[e]++,this._isColumn?(Z(i.element,t.crossAxisSize),q(i.element,t.itemSizes[e])):(Z(i.element,t.itemSizes[e]),q(i.element,t.crossAxisSize)))}}calculateAbsoluteSizes(){const t=(this.contentItems.length-(this.ignoringChild?2:1))*this._splitterSize,{width:e,height:i}=j(this.element);let n,o;this._isColumn?(n=i-t,o=e):(n=e-t,o=i);let s=0;const r=[];for(const t of this.contentItems){let e;if(t.ignoring)e=0;else{if(t.sizeUnit!==w.Percent)throw new d("ROCCAS6692");e=Math.floor(n*(t.size/100))}s+=e,r.push(e)}return{itemSizes:r,additionalPixel:Math.floor(n-s),totalSize:n,crossAxisSize:o}}calculateRelativeSizes(){let t=0;const e=[];let i=0;for(let n=0;n<this.contentItems.length;n++){if(this.contentItems[n].ignoring)continue;const o=this.contentItems[n];switch(o.sizeUnit){case w.Percent:t+=o.size;break;case w.Fractional:e.push(o),i+=o.size;break;default:throw new d("ROCCRS49110",JSON.stringify(o))}}if(100!==Math.round(t))if(Math.round(t)<100&&e.length>0){const n=100-t;for(let t=0;t<e.length;t++){const o=e[t];o.size=n*(o.size/i),o.sizeUnit=w.Percent}this.respectMinItemSize()}else{if(Math.round(t)>100&&e.length>0){for(let t=0;t<e.length;t++){const n=e[t];n.size=n.size/i*50,n.sizeUnit=w.Percent}t+=50}for(let e=0;e<this.contentItems.length;e++){const i=this.contentItems[e];i.size=i.size/t*100}this.respectMinItemSize()}else this.respectMinItemSize()}respectMinItemSize(){const t=this.calculateContentItemMinSize(this);if(!(t<=0||this.contentItems.length<=1)){let e=0,i=0;const n=[],o=[],s=this.calculateAbsoluteSizes();for(let r=0;r<s.itemSizes.length;r++){const a=s.itemSizes[r];let l;a<t?(i+=t-a,l={size:t}):(e+=a-t,l={size:a},n.push(l)),o.push(l)}if(0===i||i>e)return;{const r=i/e;let a=i;for(let e=0;e<n.length;e++){const i=n[e],o=Math.round((i.size-t)*r);a-=o,i.size-=o}0!==a&&(o[o.length-1].size-=a);for(let t=0;t<this.contentItems.length;t++)this.contentItems[t].size=o[t].size/s.totalSize*100}}}createSplitter(t){const e=new pt(this._isColumn,this._splitterSize,this._splitterGrabSize);return e.on("drag",((t,i)=>this.onSplitterDrag(e,t,i))),e.on("dragStop",(()=>this.onSplitterDragStop(e))),e.on("dragStart",(()=>this.onSplitterDragStart(e))),this._splitter.splice(t,0,e),e}getSplitItems(t){const e=this._splitter.indexOf(t);return{before:this.contentItems[e],after:this.contentItems[e+1]}}calculateContentItemMinSize(t){const e=t.minSize;if(void 0!==e){if(t.minSizeUnit===w.Pixel)return e;throw new d("ROCGMD98831",JSON.stringify(t))}{const t=this.layoutManager.layoutConfig.dimensions;return this._isColumn?t.defaultMinItemHeight:t.defaultMinItemWidth}}calculateContentItemsTotalMinSize(t){let e=0;for(const i of t)e+=this.calculateContentItemMinSize(i);return e}onSplitterDragStart(t){const e=this.getSplitItems(t),i=V(e.before.element.style[this._dimension]),n=V(e.after.element.style[this._dimension]),o=this.calculateContentItemsTotalMinSize(e.before.contentItems),s=this.calculateContentItemsTotalMinSize(e.after.contentItems);this._splitterPosition=0,this._splitterMinPosition=-1*(i-o),this._splitterMaxPosition=n-s}onSplitterDrag(t,e,i){let n=this._isColumn?i:e;if(null===this._splitterMinPosition||null===this._splitterMaxPosition)throw new c("ROCOSD59226");n=Math.max(n,this._splitterMinPosition),n=Math.min(n,this._splitterMaxPosition),this._splitterPosition=n;const o=N(n-t.dragHandleOffset);this._isColumn?t.dragHandleElement.style.top=o:t.dragHandleElement.style.left=o}onSplitterDragStop(t){if(null===this._splitterPosition)throw new c("ROCOSDS66932");{const e=this.getSplitItems(t),i=V(e.before.element.style[this._dimension]),n=V(e.after.element.style[this._dimension]),o=(this._splitterPosition+i)/(i+n),s=e.before.size+e.after.size;e.before.size=o*s,e.after.size=(1-o)*s;const r=t.dragHandleOffset;this._isColumn?t.dragHandleElement.style.top=-r+"px":t.dragHandleElement.style.left=-r+"px",globalThis.requestAnimationFrame((()=>this.updateSize()))}}}!function(t){t.getElementDimensionSize=function(t,e){return"width"===e?function(t){return t.offsetWidth}(t):function(t){return t.offsetHeight}(t)},t.setElementDimensionSize=function(t,e,i){return"width"===e?Z(t,i):q(t,i)}}(gt||(gt={}));class ft extends ct{constructor(t,e,i,n){super(t,M.create(e),null,function(t,e){const i=st.createElement("lm_root");return t.insertBefore(i,e),i}(i,n)),this.element.classList.add("lm_goldenlayout"),this.isGround=!0,this._childElementContainer=this.element,this._containerElement=i}init(){if(!0!==this.isInitialised){this.updateNodeSize();for(let t=0;t<this.contentItems.length;t++)this._childElementContainer.appendChild(this.contentItems[t].element);super.init(),this.initContentItems()}}loadRoot(t){if(this.clearRoot(),void 0!==t){const e=this.layoutManager.createAndInitContentItem(t,this);this.addChild(e,0)}}clearRoot(){const t=this.contentItems;switch(t.length){case 0:return;case 1:return void t[0].remove();default:throw new d("GILR07721")}}addItem(t,e){this.layoutManager.checkMinimiseMaximisedStack();const i=A.resolve(t,!1);let n;if(n=this.contentItems.length>0?this.contentItems[0]:this,n.isComponent)throw new Error("Cannot add item as child to ComponentItem");{const t=this.layoutManager.createAndInitContentItem(i,n);return e=n.addChild(t,e),n===this?-1:e}}loadComponentAsRoot(t){this.clearRoot();const e=A.resolve(t,!1);if(e.maximised)throw new Error("Root Component cannot be maximised");{const t=new ut(this.layoutManager,e,this);t.init(),this.addChild(t,0)}}addChild(t,e){if(this.contentItems.length>0)throw new Error("Ground node can only have a single child");return this._childElementContainer.appendChild(t.element),e=super.addChild(t,e),this.updateSize(),this.emitBaseBubblingEvent("stateChanged"),e}calculateConfigContent(){const t=this.contentItems,e=t.length,i=new Array(e);for(let n=0;n<e;n++){const e=t[n].toConfig();if(!z.isRootItemConfig(e))throw new d("RCCC66832");i[n]=e}return i}setSize(t,e){void 0===t||void 0===e||(Z(this.element,t),q(this.element,e),this.contentItems.length>0&&(Z(this.contentItems[0].element,t),q(this.contentItems[0].element,e))),this.updateSize()}createSideAreas(){const t=ft.Area.oppositeSides,e=new Array(Object.keys(t).length);let i=0;for(const n in t){const o=n,s=this.getElementArea();if(null===s)throw new c("RCSA77553");s.side=o,"2"===t[o][1]?s[o]=s[t[o]]-50:s[o]=s[t[o]]+50,s.surface=(s.x2-s.x1)*(s.y2-s.y1),e[i++]=s}return e}highlightDropZone(t,e,i){this.layoutManager.tabDropPlaceholder.remove(),super.highlightDropZone(t,e,i)}onDrop(t,e){if(t.isComponent){const e=x.createDefault(),i=t;e.header=E.Header.createCopy(i.headerConfig);const n=this.layoutManager.createAndInitContentItem(e,this);n.addChild(t),t=n}if(0===this.contentItems.length)this.addChild(t);else{if(t.type===y.row||t.type===y.column){const e=x.createDefault(),i=this.layoutManager.createContentItem(e,this);i.addChild(t),t=i}const i="x"==e.side[0]?y.row:y.column,n="2"==e.side[1],o=this.contentItems[0];if(o instanceof gt&&o.type===i){const e=o.contentItems[n?0:o.contentItems.length-1];o.addChild(t,n?0:void 0,!0),e.size*=.5,t.size=e.size,t.sizeUnit=w.Percent,o.updateSize()}else{const e=S.createDefault(i),s=this.layoutManager.createContentItem(e,this);this.replaceChild(o,s),s.addChild(t,n?0:void 0,!0),s.addChild(o,n?void 0:0,!0),o.size=50,t.size=50,t.sizeUnit=w.Percent,s.updateSize()}}}dock(){throw new d("GID87731")}validateDocking(){throw new d("GIVD87732")}getAllContentItems(){const t=[this];return this.deepGetAllContentItems(this.contentItems,t),t}getConfigMaximisedItems(){const t=[];return this.deepFilterContentItems(this.contentItems,t,(t=>!(!st.isStack(t)||!t.initialWantMaximise)||!(!st.isComponentItem(t)||!t.initialWantMaximise))),t}getItemsByPopInParentId(t){const e=[];return this.deepFilterContentItems(this.contentItems,e,(e=>e.popInParentIds.includes(t))),e}toConfig(){throw new Error("Cannot generate GroundItem config")}setActiveComponentItem(t,e,i){}updateNodeSize(){const{width:t,height:e}=this.layoutManager.containerWidthAndHeight();Z(this.element,t),q(this.element,e),this.contentItems.length>0&&(Z(this.contentItems[0].element,t),q(this.contentItems[0].element,e))}deepGetAllContentItems(t,e){for(let i=0;i<t.length;i++){const n=t[i],o=n.contentItems;n.ignoring||((!n.ignoringChild||n.type!==y.row&&n.type!==y.column||o.length>2)&&e.push(n),this.deepGetAllContentItems(o,e))}}deepFilterContentItems(t,e,i){for(let n=0;n<t.length;n++){const o=t[n];i(o)&&e.push(o),this.deepFilterContentItems(o.contentItems,e,i)}}}!function(t){let e;!function(t){t.oppositeSides={y2:"y1",x2:"x1",y1:"y2",x1:"x2"}}(e=t.Area||(t.Area={}))}(ft||(ft={}));class _t extends it{constructor(t,e,i,n,o,s){if(super(),this._dragListener=i,this._layoutManager=n,this._componentItem=o,this._originalParent=s,this._area=null,this._lastValidArea=null,this._dragListener.on("drag",((t,e,i)=>this.onDrag(t,e,i))),this._dragListener.on("dragStop",(()=>this.onDrop())),this.createDragProxyElements(t,e),null===this._componentItem.parent)throw new c("DPC10097");this._componentItemFocused=this._componentItem.focused,this._componentItemFocused&&this._componentItem.blur(),this._componentItem.parent.removeChild(this._componentItem,!0),this.setDimensions(),document.body.appendChild(this._element),this.determineMinMaxXY(),this._layoutManager.calculateItemAreas(),this.setDropPosition(t,e)}get element(){return this._element}createDragProxyElements(t,e){this._element=document.createElement("div"),this._element.classList.add("lm_dragProxy");const i=document.createElement("div");i.classList.add("lm_header");const n=document.createElement("div");n.classList.add("lm_tabs");const o=document.createElement("div");o.classList.add("lm_tab");const s=document.createElement("span");s.classList.add("lm_title"),o.appendChild(s),n.appendChild(o),i.appendChild(n),this._proxyContainerElement=document.createElement("div"),this._proxyContainerElement.classList.add("lm_content"),this._element.appendChild(i),this._element.appendChild(this._proxyContainerElement),this._originalParent instanceof mt&&this._originalParent.headerShow&&(this._sided=this._originalParent.headerLeftRightSided,this._element.classList.add("lm_"+this._originalParent.headerSide),[f.right,f.bottom].indexOf(this._originalParent.headerSide)>=0&&this._proxyContainerElement.insertAdjacentElement("afterend",i)),this._element.style.left=N(t),this._element.style.top=N(e),o.setAttribute("title",this._componentItem.title),s.insertAdjacentText("afterbegin",this._componentItem.title),this._proxyContainerElement.appendChild(this._componentItem.element)}determineMinMaxXY(){const t=this._layoutManager.groundItem;if(void 0===t)throw new m("DPDMMXY73109");{const e=t.element.getBoundingClientRect();this._minX=e.left+document.body.scrollLeft,this._minY=e.top+document.body.scrollTop,this._maxX=this._minX+e.width,this._maxY=this._minY+e.height}}onDrag(t,e,i){const n=i.pageX,o=i.pageY;this.setDropPosition(n,o),this._componentItem.drag()}setDropPosition(t,e){this._layoutManager.layoutConfig.settings.constrainDragToContainer&&(t<=this._minX?t=Math.ceil(this._minX):t>=this._maxX&&(t=Math.floor(this._maxX)),e<=this._minY?e=Math.ceil(this._minY):e>=this._maxY&&(e=Math.floor(this._maxY))),this._element.style.left=N(t),this._element.style.top=N(e),this._area=this._layoutManager.getArea(t,e),null!==this._area&&(this._lastValidArea=this._area,this._area.contentItem.highlightDropZone(t,e,this._area))}onDrop(){const t=this._layoutManager.dropTargetIndicator;if(null===t)throw new c("DPOD30011");let e;t.hide(),this._componentItem.exitDragMode(),null!==this._area?(e=this._componentItem,this._area.contentItem.onDrop(e,this._area)):null!==this._lastValidArea?(e=this._componentItem,this._lastValidArea.contentItem.onDrop(e,this._lastValidArea)):this._originalParent?(e=this._componentItem,this._originalParent.addChild(e)):this._componentItem.destroy(),this._element.remove(),this._layoutManager.emit("itemDropped",this._componentItem),this._componentItemFocused&&void 0!==e&&e.focus()}setDimensions(){const t=this._layoutManager.layoutConfig.dimensions;if(void 0===t)throw new Error("DragProxy.setDimensions: dimensions undefined");let e=t.dragProxyWidth,i=t.dragProxyHeight;if(void 0===e||void 0===i)throw new Error("DragProxy.setDimensions: width and/or height undefined");const n=!1===this._layoutManager.layoutConfig.header.show?0:t.headerHeight;this._element.style.width=N(e),this._element.style.height=N(i),e-=this._sided?n:0,i-=this._sided?0:n,this._proxyContainerElement.style.width=N(e),this._proxyContainerElement.style.height=N(i),this._componentItem.enterDragMode(e,i),this._componentItem.show()}}class vt{constructor(t,e,i,n,o){this._layoutManager=t,this._element=e,this._componentTypeOrFtn=i,this._componentState=n,this._title=o,this._dragListener=null,this._dummyGroundContainer=document.createElement("div");const s=L.createDefault("row");this._dummyGroundContentItem=new ft(this._layoutManager,s,this._dummyGroundContainer,null),this.createDragListener()}destroy(){this.removeDragListener()}createDragListener(){this.removeDragListener(),this._dragListener=new at(this._element),this._dragListener.on("dragStart",((t,e)=>this.onDragStart(t,e))),this._dragListener.on("dragStop",(()=>this.onDragStop()))}onDragStart(t,e){var i;const n="component";let o;if("function"==typeof this._componentTypeOrFtn){const t=this._componentTypeOrFtn();o=vt.isDragSourceComponentItemConfig(t)?{type:n,componentState:t.state,componentType:t.type,title:null!==(i=t.title)&&void 0!==i?i:this._title}:t}else o={type:n,componentState:this._componentState,componentType:this._componentTypeOrFtn,title:this._title};const s=W.resolve(o,!1),r=new ut(this._layoutManager,s,this._dummyGroundContentItem);if(this._dummyGroundContentItem.contentItems.push(r),null===this._dragListener)throw new c("DSODSD66746");new _t(t,e,this._dragListener,this._layoutManager,r,this._dummyGroundContentItem)}onDragStop(){this.createDragListener()}removeDragListener(){null!==this._dragListener&&(this._dragListener.destroy(),this._dragListener=null)}}!function(t){t.isDragSourceComponentItemConfig=function(t){return!("componentType"in t)}}(vt||(vt={}));class Ct{constructor(t=document.body,e=null){this._element=document.createElement("div"),this._element.classList.add("lm_dropTargetIndicator");const i=document.createElement("div");i.classList.add("lm_inner"),this._element.appendChild(i),t.insertBefore(this._element,e)}destroy(){this._element.remove()}highlightArea(t,e){this._element.style.left=N(t.x1+e),this._element.style.top=N(t.y1+e),this._element.style.width=N(t.x2-t.x1-e),this._element.style.height=N(t.y2-t.y1-e),this._element.style.display="block"}hide(){$(this._element,!1)}}class yt extends it{constructor(t){super(),this._layoutManager=t,this._childEventListener=t=>this.onEventFromChild(t),globalThis.addEventListener(yt.ChildEventName,this._childEventListener,{passive:!0})}emit(t,...e){"userBroadcast"===t?this.emitUserBroadcast(...e):super.emit(t,...e)}emitUserBroadcast(...t){this.handleUserBroadcastEvent("userBroadcast",t)}destroy(){globalThis.removeEventListener(yt.ChildEventName,this._childEventListener)}handleUserBroadcastEvent(t,e){this._layoutManager.isSubWindow?this.propagateToParent(t,e):this.propagateToThisAndSubtree(t,e)}onEventFromChild(t){const e=t.detail;this.handleUserBroadcastEvent(e.eventName,e.args)}propagateToParent(t,e){const i={bubbles:!0,cancelable:!0,detail:{layoutManager:this._layoutManager,eventName:t,args:e}},n=new CustomEvent(yt.ChildEventName,i),o=globalThis.opener;if(null===o)throw new c("EHPTP15778");o.dispatchEvent(n)}propagateToThisAndSubtree(t,e){this.emitUnknown(t,...e);for(let i=0;i<this._layoutManager.openPopouts.length;i++){const n=this._layoutManager.openPopouts[i].getGlInstance();n&&n.eventHub.propagateToThisAndSubtree(t,e)}}}!function(t){t.ChildEventName="gl_child_event"}(yt||(yt={})),function(t){t[t.NotDragging=0]="NotDragging",t[t.DroppedInThisWindow=1]="DroppedInThisWindow",t[t.DroppedElsewhere=2]="DroppedElsewhere",t[t.CurrentlyDragging=3]="CurrentlyDragging"}(F||(F={}));class It extends it{constructor(e){super(),this.resizeWithContainerAutomatically=!1,this.resizeDebounceInterval=100,this.resizeDebounceExtendedWhenPossible=!0,this._isInitialised=!1,this._groundItem=void 0,this._openPopouts=[],this._dropTargetIndicator=null,this._itemAreas=null,this._dragState=F.NotDragging,this._lastDragLeaveTime=0,this._dragEnterCount=0,this._maximisePlaceholder=It.createMaximisePlaceElement(document),this._tabDropPlaceholder=It.createTabDropPlaceholderElement(document),this._dragSources=[],this._updatingColumnsResponsive=!1,this._firstLoad=!0,this._eventHub=new yt(this),this._width=null,this._height=null,this._virtualSizedContainers=[],this._virtualSizedContainerAddingBeginCount=0,this._resizeObserver=new ResizeObserver((()=>this.handleContainerResize())),this._windowBeforeUnloadListener=()=>this.onBeforeUnload(),this._windowBeforeUnloadListening=!1,this._maximisedStackBeforeDestroyedListener=t=>this.cleanupBeforeMaximisedStackDestroyed(t),this._area=null,this._lastValidArea=null,this._actionsOnDragEnd=[],this.popoutClickHandler=()=>!1,this._removeItem=void 0,this.inSomeWindow=!1,this.delayedDragEndFunction=void 0,this.createComponentElement=(t,e)=>{var i,n;let o=(null===(i=this.groundItem)||void 0===i?void 0:i.element)||document.body;const s=document.createElement("div");let r=s;return(null!==(n=this.layoutConfig.settings.copyForDragImage)&&void 0!==n?n:this.layoutConfig.settings.useDragAndDrop)&&(r=document.createElement("div"),o.appendChild(r),o=r),o.appendChild(s),s.classList.add("lm_content"),r},this.isSubWindow=e.isSubWindow,this._constructorOrSubWindowLayoutConfig=e.constructorOrSubWindowLayoutConfig,t.checkInitialise(),b.checkInitialise(),void 0!==e.containerElement&&(this._containerElement=e.containerElement),void 0!==e.containerPosition&&(this._containerPosition=e.containerPosition),this.containerWidthAndHeight=()=>j(this._containerElement)}enterOrLeaveSomeWindow(t){this.inSomeWindow=t,t||(this._lastDragLeaveTime=Date.now())}get container(){return this._containerElement}get isInitialised(){return this._isInitialised}get groundItem(){return this._groundItem}get root(){return this._groundItem}get openPopouts(){return this._openPopouts}get dropTargetIndicator(){return this._dropTargetIndicator}get width(){return this._width}get height(){return this._height}get eventHub(){return this._eventHub}get rootItem(){if(void 0===this._groundItem)throw new Error("Cannot access rootItem before init");return 0===this._groundItem.contentItems.length?void 0:this._groundItem.contentItems[0]}get focusedComponentItem(){return this._focusedComponentItem}get tabDropPlaceholder(){return this._tabDropPlaceholder}get maximisedStack(){return this._maximisedStack}get deprecatedConstructor(){return!this.isSubWindow&&void 0!==this._constructorOrSubWindowLayoutConfig}destroy(){if(this._isInitialised){this._windowBeforeUnloadListening&&(globalThis.removeEventListener("beforeunload",this._windowBeforeUnloadListener),this._windowBeforeUnloadListening=!1),!0===this.layoutConfig.settings.closePopoutsOnUnload&&this.closeAllOpenPopouts(),this._resizeObserver.disconnect(),this.checkClearResizeTimeout(),void 0!==this._groundItem&&this._groundItem.destroy(),this._tabDropPlaceholder.remove(),null!==this._dropTargetIndicator&&this._dropTargetIndicator.destroy(),this._eventHub.destroy();for(const t of this._dragSources)t.destroy();this._dragSources=[],this._isInitialised=!1}}minifyConfig(t){return T.minifyConfig(t)}useNativeDragAndDrop(){return this.layoutConfig.settings.useDragAndDrop}currentlyDragging(){return this._dragState==F.CurrentlyDragging}dragDataMimetype(){return this.layoutConfig.settings.dragDataMimetype}validDragEvent(t){var e;return(null===(e=t.dataTransfer)||void 0===e?void 0:e.types.includes(this.dragDataMimetype()))||!1}unminifyConfig(t){return T.unminifyConfig(t)}_hideTargetIndicator(){const t=this.dropTargetIndicator;if(null===t)throw new c("DPOD30011");t.hide()}init(){let t;if(this.setContainer(),this.updateSizeFromContainer(),this.isSubWindow){if(void 0===this._constructorOrSubWindowLayoutConfig)throw new m("LMIU07155");{const e=this._constructorOrSubWindowLayoutConfig.root;if(void 0===e)throw new d("LMIC07156");if(!A.isComponent(e))throw new d("LMIC07157");t=e;const i=O.resolve(this._constructorOrSubWindowLayoutConfig);this.layoutConfig=Object.assign(Object.assign({},i),{root:void 0})}}else void 0===this._constructorOrSubWindowLayoutConfig?this.layoutConfig=T.createDefault():this.layoutConfig=O.resolve(this._constructorOrSubWindowLayoutConfig);const e=this.layoutConfig;this._groundItem=new ft(this,e.root,this._containerElement,this._containerPosition),this._groundItem.init();const i=this._groundItem.element;this._dropTargetIndicator=new Ct(i,i.firstChild),this.checkLoadedLayoutMaximiseItem(),this._resizeObserver.observe(this._containerElement),this._isInitialised=!0,this.adjustColumnsResponsive(),this.emit("initialised"),void 0!==t&&this.loadComponentAsRoot(t);const n=document.body;this.useNativeDragAndDrop()&&(n.addEventListener("dragover",(t=>this.onDragOver(t)),!0),n.addEventListener("dragenter",(t=>this.onDragEnter(t)),!0),n.addEventListener("dragleave",(t=>this.onDragLeave(t)),!0),n.addEventListener("dragend",(t=>{const e=t.screenX,i=t.screenY;this._dragState===F.CurrentlyDragging?(this.delayedDragEndFunction=()=>{this.delayedDragEndTimer&&clearTimeout(this.delayedDragEndTimer),this.delayedDragEndTimer=void 0,this.delayedDragEndFunction=void 0,this.onDragEnd(e,i)},this.delayedDragEndTimer=globalThis.setTimeout(this.delayedDragEndFunction,100)):this.onDragEnd(e,i,t)}),!0),n.addEventListener("drop",(t=>{console.log("drop event"),this.onDrop(t)})))}setDropPosition(t,e){this._area=this.getArea(t,e),null!==this._area&&(this._lastValidArea=this._area,this._area.contentItem.highlightDropZone(t,e,this._area))}onDrag(t){const e=t.pageX,i=t.pageY;null===this._itemAreas&&this.calculateItemAreas(),null!==this._itemAreas&&0!==this._itemAreas.length&&this.setDropPosition(e,i)}loadLayout(t){if(!this.isInitialised)throw new Error("GoldenLayout: Need to call init() if LayoutConfig with defined root passed to constructor");if(void 0===this._groundItem)throw new m("LMLL11119");this.createSubWindows(),this.layoutConfig=O.resolve(t),this._groundItem.loadRoot(this.layoutConfig.root),this.checkLoadedLayoutMaximiseItem(),this.adjustColumnsResponsive()}saveLayout(){if(!1===this._isInitialised)throw new Error("Can't create config, layout not yet initialised");if(void 0===this._groundItem)throw new m("LMTC18244");{const t=this._groundItem.calculateConfigContent();let e;e=1!==t.length?void 0:t[0],this.reconcilePopoutWindows();const i=[];for(let t=0;t<this._openPopouts.length;t++)i.push(this._openPopouts[t].toConfig());return{root:e,openPopouts:i,settings:T.Settings.createCopy(this.layoutConfig.settings),dimensions:T.Dimensions.createCopy(this.layoutConfig.dimensions),header:T.Header.createCopy(this.layoutConfig.header),resolved:!0}}}clear(){if(void 0===this._groundItem)throw new m("LMCL11129");this._groundItem.clearRoot()}toConfig(){return this.saveLayout()}newComponent(t,e,i){const n=this.newComponentAtLocation(t,e,i);if(void 0===n)throw new d("LMNC65588");return n}newComponentAtLocation(t,e,i,n){if(void 0===this._groundItem)throw new Error("Cannot add component before init");{const o=this.addComponentAtLocation(t,e,i,n);if(void 0===o)return;{const t=o.parentItem.contentItems[o.index];if(st.isComponentItem(t))return t;throw new d("LMNC992877533")}}}addComponent(t,e,i){const n=this.addComponentAtLocation(t,e,i);if(void 0===n)throw new d("LMAC99943");return n}addComponentAtLocation(t,e,i,n){const o={type:"component",componentType:t,componentState:e,title:i};return this.addItemAtLocation(o,n)}newItem(t){const e=this.newItemAtLocation(t);if(void 0===e)throw new d("LMNC65588");return e}newItemAtLocation(t,e){if(void 0===this._groundItem)throw new Error("Cannot add component before init");{const i=this.addItemAtLocation(t,e);if(void 0===i)return;return i.parentItem.contentItems[i.index]}}addItem(t){const e=this.addItemAtLocation(t);if(void 0===e)throw new d("LMAI99943");return e}addItemAtLocation(t,e){if(void 0===this._groundItem)throw new Error("Cannot add component before init");{void 0===e&&(e=It.defaultLocationSelectors);const i=this.findFirstLocation(e);if(void 0===i)return;{let e,n=i.parentItem;switch(n.type){case y.ground:e=n.addItem(t,i.index),e>=0?n=this._groundItem.contentItems[0]:e=0;break;case y.row:case y.column:e=n.addItem(t,i.index);break;case y.stack:if(A.isComponent(t)){e=n.addItem(t,i.index);break}throw Error(u[6]);case y.component:throw new d("LMAIALC87444602");default:throw new h("LMAIALU98881733",n.type)}if(A.isComponent(t)){const t=n.contentItems[e];st.isStack(t)&&(n=t,e=0)}return i.parentItem=n,i.index=e,i}}}loadComponentAsRoot(t){if(void 0===this._groundItem)throw new Error("Cannot add item before init");this._groundItem.loadComponentAsRoot(t)}updateSize(t,e){this.setSize(t,e)}setSize(t,e){if(this._width=t,this._height=e,!0===this._isInitialised){if(void 0===this._groundItem)throw new m("LMUS18881");if(this._groundItem.setSize(this._width,this._height),this._maximisedStack){const{width:t,height:e}=this.containerWidthAndHeight();Z(this._maximisedStack.element,t),q(this._maximisedStack.element,e),this._maximisedStack.updateSize()}this.adjustColumnsResponsive()}}updateSizeFromContainer(){const{width:t,height:e}=this.containerWidthAndHeight();this.setSize(t,e)}updateRootSize(){if(void 0===this._groundItem)throw new m("LMURS28881");this._groundItem.updateSize()}createAndInitContentItem(t,e){const i=this.createContentItem(t,e);return i.init(),i}createContentItem(t,e){if("string"!=typeof t.type)throw new o("Missing parameter 'type'",JSON.stringify(t));return!S.isComponentItem(t)||e instanceof mt||!e||!0===this.isSubWindow&&e instanceof ft||(t={type:y.stack,content:[t],size:t.size,sizeUnit:t.sizeUnit,minSize:t.minSize,minSizeUnit:t.minSizeUnit,id:t.id,maximised:t.maximised,isClosable:t.isClosable,activeItemIndex:0,header:void 0}),this.createContentItemFromConfig(t,e)}findFirstComponentItemById(t){return void 0===this._groundItem?void 0:this.findFirstContentItemTypeByIdRecursive(y.component,t,this._groundItem)}createPopout(t,e,i,n){return t instanceof st?this.createPopoutFromContentItem(t,e,i,n):this.createPopoutFromItemConfig(t,e,i,n)}createPopoutFromContentItem(t,e,i,n){let o=t.parent,s=t;for(;null!==o&&1===o.contentItems.length&&!o.isGround;)s=o,o=o.parent;if(null===o)throw new c("LMCPFCI00834");{if(void 0===n&&(n=o.contentItems.indexOf(s)),null!==i&&o.addPopInParentId(i),void 0===e){const i=globalThis.screenX||globalThis.screenLeft,n=globalThis.screenY||globalThis.screenTop,o=t.element.offsetLeft,s=t.element.offsetTop,{width:r,height:a}=j(t.element);e={left:i+o,top:n+s,width:r,height:a}}const r=t.toConfig();if(t.remove(),z.isRootItemConfig(r))return this.createPopoutFromItemConfig(r,e,i,n);throw new Error(`${u[0]}`)}}beginVirtualSizedContainerAdding(){0==this._virtualSizedContainerAddingBeginCount++&&(this._virtualSizedContainers.length=0)}addVirtualSizedContainer(t){this._virtualSizedContainers.push(t)}endVirtualSizedContainerAdding(){var t,e;if(0==--this._virtualSizedContainerAddingBeginCount){const i=this._virtualSizedContainers.length;if(i>0){null===(t=this.beforeVirtualRectingEvent)||void 0===t||t.call(this,i);for(let t=0;t<i;t++)this._virtualSizedContainers[t].notifyVirtualRectingRequired();null===(e=this.afterVirtualRectingEvent)||void 0===e||e.call(this),this._virtualSizedContainers.length=0}}}createPopoutFromItemConfig(t,e,i,n){const o=this.toConfig(),s={root:t,openPopouts:[],settings:o.settings,dimensions:o.dimensions,header:o.header,window:e,parentId:i,indexInParent:n,resolved:!0};return this.createPopoutFromPopoutLayoutConfig(s)}createPopoutFromPopoutLayoutConfig(t){var e,i,n,o;const s=t.window,r={left:null!==(e=s.left)&&void 0!==e?e:globalThis.screenX||globalThis.screenLeft+20,top:null!==(i=s.top)&&void 0!==i?i:globalThis.screenY||globalThis.screenTop+20,width:null!==(n=s.width)&&void 0!==n?n:500,height:null!==(o=s.height)&&void 0!==o?o:309},a=new ot(t,r,this);return a.on("initialised",(()=>this.emit("windowOpened",a))),a.on("closed",(()=>this.reconcilePopoutWindows())),this._openPopouts.push(a),this.layoutConfig.settings.closePopoutsOnUnload&&!this._windowBeforeUnloadListening&&(globalThis.addEventListener("beforeunload",this._windowBeforeUnloadListener,{passive:!0}),this._windowBeforeUnloadListening=!0),a}closeAllOpenPopouts(){for(let t=0;t<this._openPopouts.length;t++)this._openPopouts[t].close();this._openPopouts.length=0,this._windowBeforeUnloadListening&&(globalThis.removeEventListener("beforeunload",this._windowBeforeUnloadListener),this._windowBeforeUnloadListening=!1)}newDragSource(t,e,i,n){const o=new vt(this,t,e,i,n);return this._dragSources.push(o),o}removeDragSource(t){!function(t,e){const i=e.indexOf(t);if(-1===i)throw new Error("Can't remove item from array. Item is not in the array");e.splice(i,1)}(t,this._dragSources),t.destroy()}removeElementEventually(t){this.currentlyDragging()?(t.style.opacity="0",this._actionsOnDragEnd.push((e=>{e?t.style.opacity="":t.remove()}))):t.remove()}deferIfDragging(t){this.currentlyDragging()?this._actionsOnDragEnd.push(t):t(!1)}doDeferredActions(t){for(const e of this._actionsOnDragEnd)e(t);this._actionsOnDragEnd.length=0}startComponentDragOld(t,e,i,n,o){this.createDragProxy&&this.createDragProxy(n,t,e),new _t(t,e,i,this,n,o)}startComponentDrag(t,e){var i;this._dragState=F.CurrentlyDragging,this._draggedComponentItem=e;const n={config:e.toConfig()};if(t instanceof DragEvent&&t.dataTransfer){const e=JSON.stringify(n);t.dataTransfer.setData(this.dragDataMimetype(),e)}const o=e.tab.element,s=e.parent,r=s.getActiveComponentItem()===e,a=s.header.element,l=o.cloneNode(!0),d=document.createElement("section");d.classList.add("lm_tabs"),d.appendChild(l);const h=document.createElement("section");let c;h.classList.add("lm_header"),h.appendChild(d);const m=e.container.element,u=e.container.contentElement,p=!m||m===u;if(p){c=document.createElement("section"),c.classList.add("lm_dragImage");const t=document.createElement("div");t.classList.add("lm_dragImageInner"),c.appendChild(h),c.appendChild(t),document.body.appendChild(c);const e=s.element.getBoundingClientRect();c.style.top=`${e.top}px`,c.style.left=`${e.left}px`,c.style.width=`${e.width}px`,c.style.height=`${e.height}px`,t.style.left="0px",t.style.right="0px",t.style.height=e.height-d.clientHeight+"px",t.style.top=`${d.clientHeight}px`,t.style.bottom="0px"}else c=m,c.insertBefore(h,c.firstChild);if(h.style.background="transparent",h.style.position="absolute",h.style.top="0px",!r)for(const t of s.contentItems)t!==e&&(t.element.style.opacity="0");const g=c.style.opacity;c.style.opacity="0.6";const f=t.target,_=t.offsetX+f.offsetLeft,v=t.offsetY+f.offsetTop;d.style.marginLeft=`${t.target.offsetLeft}px`,null===(i=t.dataTransfer)||void 0===i||i.setDragImage(c,_,v),this.emit("dragstart",t,e),X(!1),this._removeItem=()=>{var t;if(!this._removeItem)return;this._removeItem=void 0;for(let t=e;;){const i=t.parent;if(!i)break;if(t.contentItems.length>=2)break;if((t===e||t.isStack)&&(t.ignoring=!0,i.ignoringChild=!0),i.isGround)break;t=i}const i=e.element,n=s.element.offsetParent,l=s.contentItems.length<=1;if(this.layoutConfig.settings.showOldPositionWhenDragging&&s.parent&&n&&""===i.style.position){const t=s.element.getBoundingClientRect(),e=n.getBoundingClientRect();if(s.element.classList.add("lm_drag_old_position"),s.element.style.zIndex="4",l){const i=s.element.style;i.top=t.top-e.top+"px",i.left=t.left-e.left+"px",i.width=t.width-2+"px",i.height=t.height-2+"px",i.position="absolute"}this._actionsOnDragEnd.push((t=>{if(s.element.classList.remove("lm_drag_old_position"),s.element.style.zIndex="",l){const t=s.element.style;t.top="",t.left="",t.width="",t.height="",t.position=""}}))}if(h.remove(),!r)for(const t of s.contentItems)t!==e&&(t.element.style.opacity="");o.style.visibility="",a.style.visibility="",p?c.remove():c.style.opacity=g,null===(t=e.parent)||void 0===t||t.removeChild(e,!0);const d=e.container;d.visible&&(d.setVisibility(!1),this._actionsOnDragEnd.push((t=>{d.setVisibility(!0)}))),console.log("after removeChild")},window.requestAnimationFrame(this._removeItem)}focusComponent(t,e=!1){t.focus(e)}clearComponentFocus(t=!1){this.setFocusedComponentItem(void 0,t)}setFocusedComponentItem(t,e=!1){if(t!==this._focusedComponentItem){let i;if(void 0===t||(i=t.parentItem),void 0!==this._focusedComponentItem){const t=this._focusedComponentItem;this._focusedComponentItem=void 0,t.setBlurred(e);const n=t.parentItem;i===n?i=void 0:n.setFocusedValue(!1)}void 0!==t&&(this._focusedComponentItem=t,t.setFocused(e),void 0!==i&&i.setFocusedValue(!0))}}createContentItemFromConfig(t,e){switch(t.type){case y.ground:throw new d("LMCCIFC68871");case y.row:return new gt(!1,this,t,e);case y.column:return new gt(!0,this,t,e);case y.stack:return new mt(this,t,e);case y.component:return new ut(this,t,e);default:throw new h("CCC913564",t.type,"Invalid Config Item type specified")}}setMaximisedStack(t){void 0===t?void 0!==this._maximisedStack&&this.processMinimiseMaximisedStack():t!==this._maximisedStack&&(void 0!==this._maximisedStack&&this.processMinimiseMaximisedStack(),this.processMaximiseStack(t))}checkMinimiseMaximisedStack(){void 0!==this._maximisedStack&&this._maximisedStack.minimise()}cleanupBeforeMaximisedStackDestroyed(t){null!==this._maximisedStack&&this._maximisedStack===t.target&&(this._maximisedStack.off("beforeItemDestroyed",this._maximisedStackBeforeDestroyedListener),this._maximisedStack=void 0)}closeWindow(){globalThis.setTimeout((()=>globalThis.close()),1)}getArea(t,e){let i=null,n=1/0;null===this._itemAreas&&this.calculateItemAreas();const o=this._itemAreas;for(let s=0;s<o.length;s++){const r=o[s];t>=r.x1&&t<r.x2&&e>=r.y1&&e<r.y2&&n>r.surface&&(n=r.surface,i=r)}return i}calculateItemAreas(){const t=this.getAllContentItems(),e=this._groundItem;if(void 0===e)throw new m("LMCIAR44365");if(1!==t.length){t[1].isStack?this._itemAreas=[]:this._itemAreas=e.createSideAreas();for(let e=0;e<t.length;e++){const i=t[e];if(st.isStack(i)){const t=i.getArea();if(null===t)continue;{this._itemAreas.push(t);const e=i.contentAreaDimensions;if(void 0===e)throw new m("LMCIASC45599");{const t=e.header.highlightArea,n=(t.x2-t.x1)*(t.y2-t.y1),o={x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,contentItem:i,surface:n};this._itemAreas.push(o)}}}}console.log("l-m calculateItemAreas: "+this._itemAreas.length+" areas")}else{const t=e.getElementArea();if(null===t)throw new c("LMCIARA44365");this._itemAreas=[t]}}checkLoadedLayoutMaximiseItem(){if(void 0===this._groundItem)throw new m("LMCLLMI43432");{const t=this._groundItem.getConfigMaximisedItems();if(t.length>0){let e=t[0];if(st.isComponentItem(e)){const t=e.parent;if(null===t)throw new c("LMXLLMI69999");e=t}if(!st.isStack(e))throw new d("LMCLLMI19993");e.maximise()}}}processMaximiseStack(t){if(this._maximisedStack=t,t.on("beforeItemDestroyed",this._maximisedStackBeforeDestroyedListener),t.element.classList.add("lm_maximised"),t.element.insertAdjacentElement("afterend",this._maximisePlaceholder),void 0===this._groundItem)throw new m("LMMXI19993");{this._groundItem.element.prepend(t.element);const{width:e,height:i}=this.containerWidthAndHeight();Z(t.element,e),q(t.element,i),t.updateSize(),t.focusActiveContentItem(),this._maximisedStack.emit("maximised"),this.emit("stateChanged")}}processMinimiseMaximisedStack(){if(void 0===this._maximisedStack)throw new d("LMMMS74422");{const t=this._maximisedStack;if(null===t.parent)throw new c("LMMI13668");t.element.classList.remove("lm_maximised"),this._maximisePlaceholder.insertAdjacentElement("afterend",t.element),this._maximisePlaceholder.remove(),t.parent.updateSize(),this._maximisedStack=void 0,t.off("beforeItemDestroyed",this._maximisedStackBeforeDestroyedListener),t.emit("minimised"),this.emit("stateChanged")}}reconcilePopoutWindows(){const t=[];for(let e=0;e<this._openPopouts.length;e++)!1===this._openPopouts[e].getWindow().closed?t.push(this._openPopouts[e]):this.emit("windowClosed",this._openPopouts[e]);this._openPopouts.length!==t.length&&(this._openPopouts=t,this.emit("stateChanged"))}getAllContentItems(){if(void 0===this._groundItem)throw new m("LMGACI13130");return this._groundItem.getAllContentItems()}createSubWindows(){for(let t=0;t<this.layoutConfig.openPopouts.length;t++){const e=this.layoutConfig.openPopouts[t];this.createPopoutFromPopoutLayoutConfig(e)}}handleContainerResize(){this.resizeWithContainerAutomatically&&this.processResizeWithDebounce()}processResizeWithDebounce(){this.resizeDebounceExtendedWhenPossible&&this.checkClearResizeTimeout(),void 0===this._resizeTimeoutId&&(this._resizeTimeoutId=setTimeout((()=>{this._resizeTimeoutId=void 0,this.updateSizeFromContainer()}),this.resizeDebounceInterval))}checkClearResizeTimeout(){void 0!==this._resizeTimeoutId&&(clearTimeout(this._resizeTimeoutId),this._resizeTimeoutId=void 0)}setContainer(){var t;const e=document.body,i=null!==(t=this._containerElement)&&void 0!==t?t:e;if(i===e&&null===e.firstElementChild){this.resizeWithContainerAutomatically=!0;const t=document.documentElement;t.style.height="100%",t.style.margin="0",t.style.padding="0",t.style.overflow="clip",e.style.height="100%",e.style.margin="0",e.style.padding="0",e.style.overflow="clip"}this._containerElement=i}onBeforeUnload(){this.destroy()}adjustColumnsResponsive(){if(void 0===this._groundItem)throw new m("LMACR20883");if(this._firstLoad=!1,this.useResponsiveLayout()&&!this._updatingColumnsResponsive&&this._groundItem.contentItems.length>0&&this._groundItem.contentItems[0].isRow){if(void 0===this._groundItem||null===this._width)throw new m("LMACR77412");{const t=this._groundItem.contentItems[0].contentItems.length;if(t<=1)return;{const e=this.layoutConfig.dimensions.defaultMinItemWidth;if(t*e<=this._width)return;{this._updatingColumnsResponsive=!0;const i=t-Math.max(Math.floor(this._width/e),1),n=this._groundItem.contentItems[0],o=this.getAllStacks();if(0===o.length)throw new d("LMACRS77413");{const t=o[0];for(let e=0;e<i;e++){const e=n.contentItems[n.contentItems.length-1];this.addChildContentItemsToContainer(t,e)}this._updatingColumnsResponsive=!1}}}}}}useResponsiveLayout(){const t=this.layoutConfig.settings,e=t.responsiveMode===I.always,i=t.responsiveMode===I.onload&&this._firstLoad;return e||i}addChildContentItemsToContainer(t,e){const i=e.contentItems;if(e instanceof mt)for(let n=0;n<i.length;n++){const o=i[n];e.removeChild(o,!0),t.addChild(o)}else for(let e=0;e<i.length;e++){const n=i[e];this.addChildContentItemsToContainer(t,n)}}onDragEnter(t){this._removeItem&&this._removeItem(),t.stopPropagation(),t instanceof DragEvent&&(t.dataTransfer&&(t.dataTransfer.dropEffect="move"),!this.validDragEvent(t))||(0==this._dragEnterCount&&(this.emit("drag-enter-window",t),this.calculateItemAreas()),this._dragEnterCount++,t.preventDefault())}onDragLeave(t){this._lastDragLeaveTime=Date.now(),t.stopPropagation(),t instanceof DragEvent&&!this.validDragEvent(t)||(this._dragEnterCount--,this._dragEnterCount<=0&&(this.exitDrag(),this.emit("drag-leave-window",t)))}onDragOver(t){t instanceof DragEvent&&t.dataTransfer&&(t.dataTransfer.dropEffect="move");const e=t instanceof DragEvent&&this.validDragEvent(t);this.onDrag(t),e&&this._area&&t.preventDefault()}onDragEnd(t,e,i=null){var n;console.log("onDragEnd st:"+this._dragState+" timer:"+this.delayedDragEndTimer);let o=!1;if(i instanceof DragEvent&&i.dataTransfer.mozUserCancelled&&(o=!0),this._dragState==F.CurrentlyDragging&&!o){const t=Date.now();t>=this._lastDragLeaveTime&&t-this._lastDragLeaveTime<=200&&(o=!0)}const s=this._draggedComponentItem;console.log("onDragEnd now:"+Date.now()+" cancel:"+o+" comp:"+s+" cur-drag:"+this._dragState+" in-win:"+this.inSomeWindow+" ecnt:"+this._dragEnterCount);const r=(null==s?void 0:s.parent)&&"stack"===s.parent.type&&1===s.parent.contentItems.length&&s.parent.contentItems[0]===s&&"ground"===(null===(n=s.parent.parent)||void 0===n?void 0:n.type);let a;this._draggedComponentItem&&this._dragState==F.DroppedInThisWindow&&(r?o=!0:a=this._draggedComponentItem);const l=!o&&!this.inSomeWindow&&r;if(!o&&!l&&s&&s.container&&this._dragState>=F.DroppedElsewhere){const i=s.parent;i&&"stack"===i.type&&(i.element.style.display=""),s.container.emit("dragExported",t,e,s)}this.doDeferredActions(o||!!l),a&&this._area&&this._area.contentItem.onDrop(a,this._area),X(!0),l&&s&&s.container&&s.container.emit("dragMoved",t,e,s),this._draggedComponentItem=void 0,this._dragState=F.NotDragging,this.emit("dragend")}exitDrag(){this._dragEnterCount=0,this._hideTargetIndicator()}draggingInOtherWindow(t){X(t)}droppedInOtherWindow(){this._dragState=F.DroppedElsewhere,this.delayedDragEndFunction&&this.delayedDragEndFunction()}onDrop(t){var e;let i;if(this.emit("drop",t),t instanceof DragEvent){t.dataTransfer&&(t.dataTransfer.dropEffect="move");const n=null===(e=t.dataTransfer)||void 0===e?void 0:e.getData(this.dragDataMimetype());i=n&&JSON.parse(n)}else this._draggedComponentItem&&(i={config:this._draggedComponentItem.toConfig()});if(console.log("onDrop area:"+this._area),t.preventDefault(),this.exitDrag(),null!==this._area)if(this._draggedComponentItem);else{console.log("dropped from different window "+JSON.stringify(i.config));const t=new ut(this,i.config,this.groundItem);this._area.contentItem.onDrop(t,this._area)}this._dragState=F.DroppedInThisWindow,this.delayedDragEndFunction&&this.delayedDragEndFunction()}getAllStacks(){if(void 0===this._groundItem)throw new m("LMFASC52778");{const t=[];return this.findAllStacksRecursive(t,this._groundItem),t}}findFirstContentItemType(t){if(void 0===this._groundItem)throw new m("LMFFCIT82446");return this.findFirstContentItemTypeRecursive(t,this._groundItem)}findFirstContentItemTypeRecursive(t,e){const i=e.contentItems,n=i.length;if(0!==n){for(let e=0;e<n;e++){const n=i[e];if(n.type===t)return n}for(let e=0;e<n;e++){const n=i[e],o=this.findFirstContentItemTypeRecursive(t,n);if(void 0!==o)return o}}}findFirstContentItemTypeByIdRecursive(t,e,i){const n=i.contentItems,o=n.length;if(0!==o){for(let i=0;i<o;i++){const o=n[i];if(o.type===t&&o.id===e)return o}for(let i=0;i<o;i++){const o=n[i],s=this.findFirstContentItemTypeByIdRecursive(t,e,o);if(void 0!==s)return s}}}findAllStacksRecursive(t,e){const i=e.contentItems;for(let e=0;e<i.length;e++){const n=i[e];n instanceof mt?t.push(n):n.isComponent||this.findAllStacksRecursive(t,n)}}findFirstLocation(t){const e=t.length;for(let i=0;i<e;i++){const e=t[i],n=this.findLocation(e);if(void 0!==n)return n}}findLocation(t){const e=t.index;switch(t.typeId){case 0:if(void 0===this._focusedComponentItem)return;{const t=this._focusedComponentItem.parentItem,i=t.contentItems,n=i.length;if(void 0===e)return{parentItem:t,index:n};{const o=i.indexOf(this._focusedComponentItem)+e;return o<0||o>n?void 0:{parentItem:t,index:o}}}case 1:if(void 0===this._focusedComponentItem)return;{const t=this._focusedComponentItem.parentItem;return this.tryCreateLocationFromParentItem(t,e)}case 2:{const t=this.findFirstContentItemType(y.stack);return void 0===t?void 0:this.tryCreateLocationFromParentItem(t,e)}case 3:{let t=this.findFirstContentItemType(y.row);return void 0!==t?this.tryCreateLocationFromParentItem(t,e):(t=this.findFirstContentItemType(y.column),void 0!==t?this.tryCreateLocationFromParentItem(t,e):void 0)}case 4:{const t=this.findFirstContentItemType(y.row);return void 0===t?void 0:this.tryCreateLocationFromParentItem(t,e)}case 5:{const t=this.findFirstContentItemType(y.column);return void 0===t?void 0:this.tryCreateLocationFromParentItem(t,e)}case 6:if(void 0===this._groundItem)throw new m("LMFLRIF18244");return void 0!==this.rootItem?void 0:void 0===e||0===e?{parentItem:this._groundItem,index:0}:void 0;case 7:if(void 0===this._groundItem)throw new m("LMFLF18244");{const t=this._groundItem.contentItems;if(0===t.length)return void 0===e||0===e?{parentItem:this._groundItem,index:0}:void 0;{const i=t[0];return this.tryCreateLocationFromParentItem(i,e)}}}}tryCreateLocationFromParentItem(t,e){const i=t.contentItems.length;return void 0===e?{parentItem:t,index:i}:e<0||e>i?void 0:{parentItem:t,index:e}}}!function(t){t.createMaximisePlaceElement=function(t){const e=t.createElement("div");return e.classList.add("lm_maximise_place"),e},t.createTabDropPlaceholderElement=function(t){const e=t.createElement("div");return e.classList.add("lm_drop_tab_placeholder"),e},t.defaultLocationSelectors=[{typeId:1,index:void 0},{typeId:2,index:void 0},{typeId:3,index:void 0},{typeId:7,index:void 0}],t.afterFocusedItemIfPossibleLocationSelectors=[{typeId:0,index:1},{typeId:2,index:void 0},{typeId:3,index:void 0},{typeId:7,index:void 0}]}(It||(It={}));class wt extends It{constructor(t,e,i,n){if(super(wt.createLayoutManagerConstructorParameters(t,e,i)),this._bindComponentEventHanlderPassedInConstructor=!1,this._creationTimeoutPassed=!1,void 0!==e&&"function"==typeof e&&(this.bindComponentEvent=e,this._bindComponentEventHanlderPassedInConstructor=!0,"function"==typeof i&&(this.unbindComponentEvent=i)),!this._bindComponentEventHanlderPassedInConstructor&&this.isSubWindow){if(void 0===this._constructorOrSubWindowLayoutConfig)throw new m("VLC98823");{const t=O.resolve(this._constructorOrSubWindowLayoutConfig);this.layoutConfig=Object.assign(Object.assign({},t),{root:void 0})}}!0!==n&&(this.deprecatedConstructor||this.init())}destroy(){this.bindComponentEvent=void 0,this.unbindComponentEvent=void 0,super.destroy()}init(){if(this._bindComponentEventHanlderPassedInConstructor||"loading"!==document.readyState&&null!==document.body){if(!this._bindComponentEventHanlderPassedInConstructor&&!0===this.isSubWindow&&!this._creationTimeoutPassed)return setTimeout((()=>this.init()),7),void(this._creationTimeoutPassed=!0);!0===this.isSubWindow&&(this._bindComponentEventHanlderPassedInConstructor||this.clearHtmlAndAdjustStylesForSubWindow(),window.__glInstance=this),super.init()}else document.addEventListener("DOMContentLoaded",(()=>this.init()),{passive:!0})}clearHtmlAndAdjustStylesForSubWindow(){const t=document.head,e=new Array(4);e[0]=document.querySelectorAll("body link"),e[1]=document.querySelectorAll("body style"),e[2]=document.querySelectorAll("template"),e[3]=document.querySelectorAll(".gl_keep");for(let i=0;i<e.length;i++){const n=e[i];for(let e=0;e<n.length;e++){const i=n[e];t.appendChild(i)}}const i=document.body;i.innerHTML="",i.style.visibility="visible",this.checkAddDefaultPopinButton(),document.body.offsetHeight}checkAddDefaultPopinButton(){if(this.layoutConfig.settings.popInOnClose)return!1;{const t=document.createElement("div");t.classList.add("lm_popin"),t.setAttribute("title",this.layoutConfig.header.dock);const e=document.createElement("div");e.classList.add("lm_icon");const i=document.createElement("div");return i.classList.add("lm_bg"),t.appendChild(e),t.appendChild(i),t.addEventListener("click",(()=>this.emit("popIn"))),document.body.appendChild(t),!0}}unbindComponent(t,e){void 0!==this.unbindComponentEvent&&this.unbindComponentEvent(t)}}!function(t){let e=!1;t.createLayoutManagerConstructorParameters=function(t,i,n){"object"!=typeof t||t instanceof HTMLElement||!t.settings||!1!==t.settings.checkGlWindowKey||(e=!0);const o=e?null:new URL(document.location.href).searchParams.get("gl-window");e=!0;const s=null!==o;let r,a,l=null;if(null!==o){const e=localStorage.getItem(o);if(null===e)throw new Error("Null gl-window Config");localStorage.removeItem(o);const i=JSON.parse(e),n=T.unminifyConfig(i);a=O.fromResolved(n),t instanceof HTMLElement&&(r=t)}else void 0===t?a=void 0:t instanceof HTMLElement?(a=void 0,r=t):a=t,void 0===r&&i instanceof HTMLElement&&(r=i,n instanceof Node&&(l=n));return{constructorOrSubWindowLayoutConfig:a,isSubWindow:s,containerElement:r,containerPosition:l}}}(wt||(wt={}));class bt extends wt{constructor(t,e,i){super(t,e,i,!0),this._componentTypesMap=new Map,this._registeredComponentMap=new Map,this._virtuableComponentMap=new Map,this._containerVirtualVisibilityChangeRequiredEventListener=(t,e)=>this.handleContainerVirtualVisibilityChangeRequiredEvent(t,e),this._containerVirtualZIndexChangeRequiredEventListener=(t,e,i)=>this.handleContainerVirtualZIndexChangeRequiredEvent(t,e,i),this.deprecatedConstructor||this.init()}registerComponent(t,e){if("function"!=typeof e)throw new a("Please register a constructor function");if(void 0!==this._componentTypesMap.get(t))throw new a(`${u[3]}: ${t}`);this._componentTypesMap.set(t,e)}registerComponentDefault(t){if("function"!=typeof t)throw new a("Please register a constructor function");if(void 0!==this._componentTypesDefault)throw new a(`${u[3]} - default`);this._componentTypesDefault=t}getRegisteredComponentTypeNames(){const t=this._componentTypesMap.keys();return Array.from(t)}getComponentInstantiator(t){let e;const i=D.resolveComponentTypeName(t);return void 0!==i&&(e=this._componentTypesMap.get(i)),e||this._componentTypesDefault}bindComponent(t,e){const i=this.getComponentInstantiator(e);let n;if(void 0!==i){let o;o=void 0===e.componentState?void 0:J({},e.componentState),void 0!==i&&(n=i(t,o))}return n}unbindComponent(t,e){}handleContainerVirtualVisibilityChangeRequiredEvent(t,e){const i=this._virtuableComponentMap.get(t);if(void 0===i)throw new m("GLHCVVCRE55934");{const n=i.rootHtmlElement;if(void 0===n)throw new a(u[4]+" "+t.title);$(n,e)}}handleContainerVirtualZIndexChangeRequiredEvent(t,e,i){const n=this._virtuableComponentMap.get(t);if(void 0===n)throw new m("GLHCVZICRE55935");{const e=n.rootHtmlElement;if(void 0===e)throw new a(u[4]+" "+t.title);e.style.zIndex=i}}}return i})()));