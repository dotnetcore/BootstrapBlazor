@page "/dialog-service"
@layout MainLayout
@inject IStringLocalizer<DialogServices> Localizer

<h3>@((MarkupString)Localizer["Title"].Value)</h3>
<h4>@Localizer["SubTitle"]</h4>

<p class="code-label">@Localizer["CodeLabel1"]</p>

<Pre>[Inject]
[NotNull]
private DialogService? DialogService { get; set; }</Pre>

<p class="code-label">@Localizer["CodeLabel2"]</p>
<p>@((MarkupString)Localizer["UseServiceDesc"].Value)</p>

<Pre>DialogService.Show(new DialogOption()
{
    Title = "Dialog Title"
})</Pre>

<p class="code-label">@Localizer["CodeLabel3"]</p>

<ul class="ul-demo">
    <li>@((MarkupString)Localizer["DesignTip1"].Value)</li>
    <li>@((MarkupString)Localizer["DesignTip2"].Value)</li>
    <li>@((MarkupString)Localizer["DesignTip3"].Value)</li>
</ul>

<p class="code-label">@Localizer["CodeLabel4"]</p>

<div>
    <GroupBox Title="@Localizer["GroupBoxModalTitle"]" class="mb-3">
        <p>@((MarkupString)Localizer["GroupBoxModalDesc"].Value)</p>
<Pre>private async Task OnClick()
{
    // 弹出模态框
    // Open a modal dialog 
    var result = await DialogService.ShowModal&lt;ResultDialogDemo&gt;(new ResultDialogOption()
    {
        Title = "Modal popup with return value",
        ComponentParameters = new Dictionary&lt;string, object&gt;
        {
            [nameof(ResultDialogDemo.Value)] = DemoValue1,
            [nameof(ResultDialogDemo.ValueChanged)] = EventCallback.Factory.Create&lt;int&gt;(this, v => DemoValue1 = v)
        }
    });

    // 模态框不关闭时此处代码不执行
    // Code here does not run until the modal is closed
    // 后续逻辑根据弹窗返回值进行相对应的逻辑处理
    // Handle subsequent logic based on the return value of the dialog
    ModalDialogLogger.Log($"The return value of the popup window is: {result} The return value of the component is: {DemoValue1}");
}</Pre>

        <p>@((MarkupString)Localizer["ModalIdeaIntro"].Value)</p>

        <p>@((MarkupString)Localizer["ModalIdeaP1"].Value)</p>

        <p>@((MarkupString)Localizer["ModalIdeaP2"].Value)</p>
    </GroupBox>

    <GroupBox Title="@Localizer["GroupBoxSetResultTitle"]" class="mb-3">
        <p>@((MarkupString)Localizer["SetResultIntro"].Value)</p>
        <Pre>[CascadingParameter(Name = "ResultDialogContext")]
private Func&lt;DialogResult, Task&gt;? SetResultAsync { get; set; }

private async Task OnClick(DialogResult dialogResult)
{
    if (SetResultAsync != null)
    {
        await SetResultAsync(dialogResult);
    }
}</Pre>
        <p>@Localizer["SetResultNote"]</p>
        <Pre>&lt;DialogCloseButton Color="@@ButtonNoColor" Icon="@@ButtonNoIcon" Text="@@ButtonNoText" OnClickWithoutRender="() => OnClick(DialogResult.No)" /></Pre>
        <p>@((MarkupString)Localizer["SetResultNote2"].Value)</p>
        <p>@((MarkupString)Localizer["SetResultNote3"].Value)</p>
    </GroupBox>

    <GroupBox Title="@Localizer["GroupBoxCloseInCodeTitle"]" class="mb-3">
        <p>@((MarkupString)Localizer["CloseInCodeIntro"].Value)</p>

        <ul class="ul-demo mb-0">
            <li>@((MarkupString)Localizer["CloseInCodeLi1"].Value)</li>
            <p>@Localizer["CloseInCodeLi1Desc"]</p>
            <Pre>&lt;DialogCloseButton&gt;</Pre>
            <p>@((MarkupString)Localizer["CloseInCodeLi1Desc2"].Value)</p>
            <li>@Localizer["CloseInCodeLi2"]</li>
            <Pre class="mt-3">[CascadingParameter]
private Func&lt;Task&gt;? OnCloseAsync { get; set; }</Pre>
            <p>@Localizer["CloseInCodeLi2Desc"]</p>
            <p>@((MarkupString)Localizer["CloseInCodeLi2Note"].Value)</p>
            <li>@Localizer["CloseInCodeLi3"]</li>
            <p>@((MarkupString)Localizer["CloseInCodeLi3Desc"].Value)</p>
            <Pre>[CascadingParameter]
[NotNull]
private Modal? Modal { get; set; }

private Task CloseDialogAsync() => Modal.Close()</Pre>
        </ul>
    </GroupBox>

    <GroupBox Title="@Localizer["GroupBoxInterceptCloseTitle"]" class="mb-3">
        <p>@((MarkupString)Localizer["InterceptCloseIntro"].Value)</p>
        <ul class="ul-demo mb-0">
            <li>@((MarkupString)Localizer["InterceptCloseLi1"].Value)</li>
            <Pre class="mt-3">/// &lt;summary&gt;
/// &lt;para lang="zh"&gt;关闭之前回调方法 返回 true 时关闭弹窗 返回 false 时阻止关闭弹窗&lt;/para&gt;
/// &lt;para lang="en"&gt;Callback Method Before Closing. Return true to close, false to prevent closing&lt;/para&gt;
/// &lt;/summary&gt;
Func&lt;Task&lt;bool&gt;&gt;? OnClosingAsync { get; set; }</Pre>
            <p>@((MarkupString)Localizer["InterceptCloseLi1Desc"].Value)</p>
            <li>@((MarkupString)Localizer["InterceptCloseLi2"].Value)</li>
            <p class="mt-3">@((MarkupString)Localizer["InterceptCloseLi2Desc"].Value)</p>
            <Pre Height="1082px">[CascadingParameter]
private Modal? Modal { get; set; }

protected override void OnInitialized()
{
    base.OnInitialized();

    // 通过 Modal 实例方法 RegisterOnClosingCallback 注册关闭回调方法
    // Register the closing callback via Modal.RegisterOnClosingCallback
    Modal?.RegisterOnClosingCallback(OnClosingCallback);
}

private async Task&lt;bool&gt; OnClosingCallback()
{
    var ret = true;

    // 根据自己的业务逻辑分析是否有更改 _hasFieldValueChanged 表示编辑表单是否有属性被更改
    // Check whether the form has changes; _hasFieldValueChanged indicates if any form field was modified
    // 可以通过 ValidateForm 组件的参数 OnFieldValueChanged 在回调中设置 _hasFieldValueChanged 的值
    // Set _hasFieldValueChanged in the OnFieldValueChanged callback of ValidateForm
    if (_hasFieldValueChanged)
    {
        var op = new SwalOption()
        {
            Title = "请注意",
            Content = "表单已经更改，确定要关闭么？",
            Category = SwalCategory.Question
        };
        ret = await SwalService.ShowModal(op);
    }

    // 业务逻辑处理后返回 true 关闭弹窗 返回 false 阻止关闭弹窗
    // Return true to close the dialog, false to prevent closing
    return ret;
}

private void OnFieldValueChanged(string fieldName, object? value)
{
    // fieldName 当前更改的属性名称 value 当前更改的属性值 根据自己的业务逻辑分析是否有更改
    // fieldName: name of the changed property; value: new value; set _hasFieldValueChanged per your logic
    _hasFieldValueChanged = true;
}

private void Dispose(bool disposing)
{
    if (disposing)
    {
        // 通过 Modal 实例方法 UnRegisterOnClosingCallback 注销关闭回调方法
        // Unregister the closing callback via Modal.UnRegisterOnClosingCallback
        Modal?.UnRegisterOnClosingCallback(OnClosingCallback);
    }
}</Pre>

<p>@((MarkupString)Localizer["ValidateFormTip"].Value)</p>

<Pre>&lt;ValidateForm Model="Model" OnFieldValueChanged="OnFieldValueChanged" OnValidSubmit="OnValidSubmit"&gt;&lt;/ValidateForm&gt;</Pre>
        </ul>
    </GroupBox>

    <GroupBox Title="@Localizer["GroupBoxNoFooterTitle"]" class="mb-3">
        <Pre>private async Task OnClickShowDataById()
{
    var op = new DialogOption
    {
        Title = "Dialog Title",
        ShowFooter = false,
        Component = BootstrapDynamicComponent.CreateComponent&lt;DataDialogComponent&gt;()
    };

    await DialogService.Show(op);
}</Pre>

        <p>@((MarkupString)Localizer["NoFooterDesc"].Value)</p>
        <ul class="ul-demo mb-0">
            <li>@((MarkupString)Localizer["NoFooterLi1"].Value)</li>
            <p>@Localizer["NoFooterLi1Desc"]</p>
            <li>@((MarkupString)Localizer["NoFooterLi2"].Value)</li>
            <p>@((MarkupString)Localizer["NoFooterLi2Desc"].Value)</p>
        </ul>
    </GroupBox>

    <GroupBox Title="@Localizer["GroupBoxExtensionsTitle"]" class="mb-3">
        <p>@((MarkupString)Localizer["ExtensionsIntro"].Value)</p>
        <ul class="ul-demo mb-0">
            <li>@((MarkupString)Localizer["ExtensionsLi1"].Value)</li>
            <p>@((MarkupString)Localizer["ExtensionsLi1Desc"].Value)</p>
            <li>@((MarkupString)Localizer["ExtensionsLi2"].Value)</li>
            <p>@((MarkupString)Localizer["ExtensionsLi2Desc"].Value)</p>
            <li>@((MarkupString)Localizer["ExtensionsLi3"].Value)</li>
            <p>@((MarkupString)Localizer["ExtensionsLi3Desc"].Value)</p>
            <li>@((MarkupString)Localizer["ExtensionsLi4"].Value)</li>
            <p>@((MarkupString)Localizer["ExtensionsLi4Desc"].Value)</p>
            <li>@((MarkupString)Localizer["ExtensionsLi5"].Value)</li>
            <p>@((MarkupString)Localizer["ExtensionsLi5Desc"].Value)</p>
            <li>@((MarkupString)Localizer["ExtensionsLi6"].Value)</li>
            <div>@((MarkupString)Localizer["ExtensionsLi6Desc"].Value)</div>
        </ul>
    </GroupBox>

    <GroupBox Title="@Localizer["GroupBoxTableEditFooterTitle"]" class="mb-3">
        <p>@((MarkupString)Localizer["TableEditFooterDesc"].Value)</p>
    </GroupBox>

    <GroupBox Title="@Localizer["GroupBoxValidateFormTitle"]">
        <p>@((MarkupString)Localizer["ValidateFormInstanceDesc"].Value)</p>
        <Pre>[CascadingParameter]
private ValidateForm? ValidateForm { get; set; }</Pre>
    </GroupBox>
</div>
